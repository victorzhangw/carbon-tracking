# Flask-AICares 代碼分析文檔

## 概述

本目錄包含對 Flask-AICares 項目的完整代碼分析與技術文檔。所有分析基於項目實際代碼，提供深入的架構理解和技術洞察。

## 文檔列表

### 📋 01_项目架构分析.md
**完整的項目架構剖析**

涵蓋內容：
- 專案概述與技術棧
- 核心入口文件分析
- 路由模組架構（10個路由）
- 服務層架構（AI、語音、情緒識別）
- 功能模組（碳追蹤、ASR、語音處理）
- PWA與Android應用
- 數據庫設計
- 配置與資產管理
- 腳本工具系統
- 文檔體系

**適合閱讀對象：**
- 新加入的開發者
- 需要了解整體架構的技術人員
- 項目評審人員

---

### 🔄 02_核心流程分析.md
**關鍵業務流程詳解**

涵蓋內容：
- 語音克隆完整流程（樣本上傳→處理→模型設置）
- 多輪對話語音生成流程
- 語音對話完整鏈路（語音輸入→識別→AI分析→語音輸出）
- ASR雙引擎識別流程（Whisper + FunASR）
- 碳排放追蹤流程（記錄創建→統計分析→數據匯出）
- 認證授權流程（登入→Token管理→權限驗證）
- 情緒識別流程（單音頻/批量分析）
- 關鍵優化點與性能策略

**適合閱讀對象：**
- 需要理解業務邏輯的開發者
- 進行功能開發或調試的工程師
- 需要優化性能的技術人員

**包含流程圖：**
- Mermaid格式的流程圖
- 數據流示例
- 關鍵代碼路徑

---

### 💡 03_技术细节与最佳实践.md
**深入的技術實現與編碼規範**

涵蓋內容：

**數據庫設計：**
- 9個核心表結構（用戶、角色、權限、音頻、語音模型等）
- 分頁查詢實現
- 事務處理策略
- 軟刪除模式

**API設計規範：**
- RESTful路由設計
- 統一響應格式
- 錯誤處理模式
- 參數驗證

**認證授權：**
- JWT Token管理（8小時Access + 30天Refresh）
- RBAC權限系統
- 裝飾器實現
- 角色權限映射

**文件處理：**
- 安全文件上傳
- 目錄組織策略
- 文件服務（串流/下載）

**AI服務集成：**
- DeepSeek API調用
- 提示詞工程
- GPT-SoVITS TTS集成

**性能優化：**
- 數據庫索引策略
- 快取機制（LRU Cache）
- 異步處理（AsyncIO）

**安全實踐：**
- 輸入驗證
- SQL注入防護
- 密碼安全（bcrypt）
- 日誌與監控

**適合閱讀對象：**
- 進行深入開發的工程師
- 代碼審查人員
- 需要理解技術細節的架構師

---

## 快速導航

### 按角色查找

**項目經理 / 產品經理**
1. 先閱讀：`01_项目架构分析.md` 的"專案概述"、"核心功能"
2. 然後閱讀：`02_核心流程分析.md` 了解業務流程
3. 重點關注：功能模組、業務邏輯

**新加入的開發者**
1. 必讀順序：`01` → `02` → `03`
2. 先理解架構，再深入流程，最後掌握細節
3. 配合實際代碼閱讀

**資深開發者**
1. 快速瀏覽：`01_项目架构分析.md` 了解結構
2. 重點閱讀：`03_技术细节与最佳实践.md`
3. 參考：`02_核心流程分析.md` 的優化策略

**運維 / DevOps**
1. 重點閱讀：`01_项目架构分析.md` 的"配置管理"、"腳本工具"
2. 參考：`03_技术细节与最佳实践.md` 的"日誌與監控"
3. 關注：部署配置、數據庫結構

### 按任務查找

**理解整體架構**
→ `01_项目架构分析.md`

**開發新功能**
→ `02_核心流程分析.md` + `03_技术细节与最佳实践.md`

**性能優化**
→ `03_技术细节与最佳实践.md` 的"性能優化策略"

**安全加固**
→ `03_技术细节与最佳实践.md` 的"安全最佳實踐"

**數據庫設計**
→ `03_技术细节与最佳实践.md` 的"數據庫設計"

**API開發**
→ `03_技术细节与最佳实践.md` 的"API設計規範"

---

## 統計數據

### 代碼規模
```
總行數統計（核心代碼）:
- 路由層（routes/）: ~3,000 行
- 服務層（services/）: ~1,500 行
- 數據層（database.py）: 699 行
- 模組層（modules/）: ~1,500 行
- 總計: ~6,700 行核心業務代碼
```

### 文件結構
```
核心文件數量:
- Python文件: 50+
- 模板文件: 15+
- 配置文件: 20+
- 腳本文件: 30+
- 文檔文件: 40+
```

### 功能模組
```
五大核心模組:
1. 碳排放追蹤系統 ✅
2. 語音克隆與合成 🎵
3. 語音識別（ASR）🎤
4. 情緒識別 😊
5. 人才評鑑 📊
```

---

## 技術棧總覽

### 後端
- **框架**: Flask 3.x
- **數據庫**: SQLite
- **認證**: Flask-JWT-Extended
- **密碼**: bcrypt
- **CORS**: Flask-CORS

### AI & 語音
- **大語言模型**: DeepSeek-V3 (via SiliconFlow)
- **語音克隆**: GPT-SoVITS
- **語音合成**: F5-TTS
- **語音識別**: Whisper + FunASR
- **情緒識別**: Librosa + Wav2Vec2

### 音視頻處理
- **核心工具**: FFmpeg
- **音頻分析**: Librosa
- **語音識別**: SpeechRecognition

### 前端
- **PWA**: Service Worker + Manifest
- **框架**: React / Next.js (在 webpage/)
- **移動端**: Android (WebView)

### 開發工具
- **包管理**: pip (Python) + npm (Node.js)
- **版本控制**: Git
- **依賴分層**: base/full/minimal/voice/asr/carbon

---

## 關鍵指標

### API端點
- **總計**: 60+ 個端點
- **認證**: 5個端點（登入/登出/註冊/刷新/個人資料）
- **業務**: 40+ 個端點
- **管理**: 15+ 個端點

### 數據表
- **核心表**: 15個
- **用戶系統**: 5個表
- **業務數據**: 7個表
- **關聯表**: 3個表

### 權限系統
- **角色**: 4種（admin/manager/staff/viewer）
- **權限**: 11個基礎權限
- **裝飾器**: 3個（token/permission/role）

---

## 使用建議

### 學習路徑

**階段一：了解架構（1-2天）**
- 閱讀 `01_项目架构分析.md`
- 瀏覽項目目錄結構
- 運行項目並測試基本功能

**階段二：理解流程（2-3天）**
- 深入閱讀 `02_核心流程分析.md`
- 調試關鍵業務流程
- 追蹤代碼執行路徑

**階段三：掌握細節（3-5天）**
- 研讀 `03_技术细节与最佳实践.md`
- 實踐編碼規範
- 優化現有代碼

### 開發建議

1. **新功能開發**
   - 參考現有模組結構
   - 遵循API設計規範
   - 實現完整錯誤處理

2. **代碼審查重點**
   - 安全性檢查
   - 性能考量
   - 錯誤處理
   - 日誌記錄

3. **測試策略**
   - 單元測試（services/）
   - 整合測試（routes/）
   - 性能測試（關鍵流程）

---

## 維護說明

### 文檔更新

當項目代碼發生重大變更時，需要更新對應文檔：

1. **架構變更** → 更新 `01_项目架构分析.md`
2. **流程變更** → 更新 `02_核心流程分析.md`
3. **技術實現變更** → 更新 `03_技术细节与最佳实践.md`

### 版本記錄

| 版本 | 日期 | 更新內容 |
|------|------|---------|
| 1.0 | 2025-11-11 | 初始版本，完整代碼分析 |

---

## 聯繫與反饋

如有任何問題或建議，請通過以下方式聯繫：

- 創建 GitHub Issue
- 提交 Pull Request
- 項目內部討論

---

**最後更新：** 2025年11月11日  
**分析範圍：** Flask-AICares 完整項目代碼  
**文檔狀態：** ✅ 完成
