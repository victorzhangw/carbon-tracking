# 進階音頻人聲分離使用指南

## 🎯 解決的問題

原始版本的問題：

- ❌ 人聲處理後變得模糊
- ❌ 無法區分不同說話者
- ❌ 過度的噪音處理影響語音品質

## ✨ 新版本的改進

### 1. 保持人聲清晰度

- **溫和噪音減少**: 使用較低強度參數，避免過度處理
- **語音增強**: 專門針對語音頻率範圍進行增強
- **高品質轉換**: 保持較高的採樣率 (22kHz)
- **預加重處理**: 增強語音的清晰度

### 2. 智能說話者分離

- **語音特徵提取**: MFCC、基頻、頻譜特徵
- **語音活動檢測**: 只在有語音的區域進行分析
- **機器學習聚類**: 使用 K-means 算法分離說話者
- **時間遮罩**: 為每個說話者創建精確的時間遮罩

### 3. 多層次輸出

- **原始分離**: 基本的說話者分離結果
- **增強版本**: 經過清晰度增強的版本
- **整體混合**: 所有說話者的增強混合版本

## 🚀 使用方法

### 快速開始

```bash
# 激活虛擬環境
.\venv\Scripts\Activate.ps1

# 處理指定檔案
python process_advanced_03041966.py
```

### 通用使用

```bash
# 處理任意音頻檔案，分離2個說話者
python advanced_voice_separation.py "path/to/audio.m4a"

# 分離3個說話者
python advanced_voice_separation.py "path/to/audio.m4a" --speakers 3

# 指定輸出目錄
python advanced_voice_separation.py "path/to/audio.m4a" --output-dir "output"
```

## 📁 輸出檔案說明

### 🎯 推薦使用的檔案

1. **`04_speaker_1_enhanced.wav`** - 說話者 1 的清晰版本
2. **`04_speaker_2_enhanced.wav`** - 說話者 2 的清晰版本
3. **`05_all_speakers_enhanced.wav`** - 整體對話的增強版本

### 📊 其他檔案

- **`01_original.wav`** - 原始音頻
- **`02_noise_reduced.wav`** - 溫和去噪版本
- **`03_speaker_X_raw.wav`** - 原始分離結果（未增強）

## 🔧 技術特點

### 語音特徵分析

- **MFCC (梅爾頻率倒譜係數)**: 13 維特徵
- **基頻 (F0)**: 音調特徵
- **頻譜重心**: 頻率分布特徵
- **頻譜滾降**: 高頻能量分布
- **零交叉率**: 語音/非語音區分

### 說話者分離算法

1. **語音活動檢測**: 基於能量閾值
2. **特徵標準化**: 確保聚類效果
3. **K-means 聚類**: 無監督說話者分離
4. **時間遮罩平滑**: 避免突兀的切換

### 語音增強技術

- **預加重**: 增強高頻成分
- **動態範圍壓縮**: 平衡音量
- **頻率選擇性增強**: 針對語音頻率
- **智能正規化**: 避免削波失真

## 📈 品質對比

| 特徵       | 原始版本 | 進階版本    |
| ---------- | -------- | ----------- |
| 人聲清晰度 | ❌ 模糊  | ✅ 清晰     |
| 說話者分離 | ❌ 無    | ✅ 智能分離 |
| 噪音處理   | ❌ 過度  | ✅ 溫和精確 |
| 處理速度   | ✅ 快    | ⚡ 適中     |
| 輸出選擇   | ❌ 單一  | ✅ 多樣化   |

## 🎛️ 參數調整

如果分離效果不理想，可以調整以下參數：

### 在 `advanced_voice_separation.py` 中：

```python
# 噪音減少強度 (第65行)
prop_decrease=0.3  # 降低 = 更溫和，提高 = 更強烈

# 語音活動檢測閾值 (第130行)
energy_threshold = np.percentile(energy, 30)  # 降低 = 更敏感

# 聚類數量
n_speakers=2  # 根據實際說話者數量調整
```

## 💡 使用建議

### 最佳實踐

1. **先聽原始檔案**: 確認說話者數量
2. **使用增強版本**: 優先選擇 `04_speaker_X_enhanced.wav`
3. **比較不同版本**: 選擇最適合的輸出
4. **調整參數**: 根據具體音頻特點微調

### 適用場景

- ✅ 電話錄音分離
- ✅ 會議記錄處理
- ✅ 訪談音頻分析
- ✅ 客服對話分離
- ✅ 播客後製處理

## 🔍 故障排除

### 常見問題

1. **說話者分離不準確**

   - 調整 `n_speakers` 參數
   - 檢查音頻品質是否足夠

2. **人聲仍然模糊**

   - 降低 `prop_decrease` 值
   - 檢查原始音頻品質

3. **處理時間過長**
   - 考慮分段處理長音頻
   - 降低採樣率（但會影響品質）

### 系統需求

- Python 3.8+
- 至少 4GB RAM
- 支援 FFmpeg 的系統
