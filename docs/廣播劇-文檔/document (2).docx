
      <html xmlns:o='urn:schemas-microsoft-com:office:office'
            xmlns:w='urn:schemas-microsoft-com:office:word'
            xmlns='http://www.w3.org/TR/REC-html40'>
      <head>
          <meta charset="utf-8">
          <title>Exported Document</title>
          <style>
              body { font-family: Arial, sans-serif; }
          </style>
      </head>
      <body>
          <h1 id="ai">AI å»£æ’­åŠ‡ç³»çµ±æ–‡æª”</h1>
<h2 id="">æ–‡æª”è³‡è¨Š</h2>
<ul>
<li><strong>ç³»çµ±åç¨±</strong>: AI å»£æ’­åŠ‡ç”Ÿæˆç³»çµ±</li>
<li><strong>ç‰ˆæœ¬</strong>: 1.0</li>
<li><strong>æœ€å¾Œæ›´æ–°</strong>: 2025-11-13</li>
<li><strong>ç‹€æ…‹</strong>: æ­£å¸¸é‹è¡Œ</li>
</ul>
<hr />
<h2 id="-1">ç³»çµ±æ¦‚è¿°</h2>
<p>AI å»£æ’­åŠ‡ç³»çµ±æ˜¯ä¸€å€‹å°‡ EPUB é›»å­æ›¸è‡ªå‹•è½‰æ›ç‚ºæœ‰è²å»£æ’­åŠ‡çš„æ™ºæ…§ç³»çµ±ã€‚ç³»çµ±æ”¯æ´å…©ç¨®å¯¦ç¾æ–¹å¼ï¼š</p>
<ol>
<li><strong>åŸºç¤ç‰ˆæœ¬</strong>: ä½¿ç”¨ GPT-SoVITS é€²è¡ŒèªéŸ³åˆæˆ</li>
<li><strong>Qwen ç‰ˆæœ¬</strong>: ä½¿ç”¨é˜¿é‡Œé›² Qwen TTS APIï¼Œæ”¯æ´æ™®é€šè©±å’Œé–©å—èªé›™èªç”Ÿæˆ</li>
</ol>
<hr />
<h2 id="-2">ç³»çµ±æ¶æ§‹</h2>
<h3 id="-3">æ ¸å¿ƒçµ„ä»¶</h3>
<pre><code>AI å»£æ’­åŠ‡ç³»çµ±
â”œâ”€â”€ è·¯ç”±å±¤ (Routes)
â”‚   â””â”€â”€ routes/audiobook.py          # åŸºç¤ç‰ˆæœ¬ API è·¯ç”±
â”‚
â”œâ”€â”€ æœå‹™å±¤ (Services)
â”‚   â”œâ”€â”€ audiobook_service.py         # åŸºç¤å»£æ’­åŠ‡æœå‹™
â”‚   â”œâ”€â”€ qwen_audiobook_service.py    # Qwen TTS å»£æ’­åŠ‡æœå‹™
â”‚   â”œâ”€â”€ voice_synthesis_service.py   # GPT-SoVITS èªéŸ³åˆæˆ
â”‚   â””â”€â”€ voice_config.py              # èªéŸ³é…ç½®
â”‚
â”œâ”€â”€ è™•ç†æµç¨‹
â”‚   â”œâ”€â”€ EPUB è§£æ
â”‚   â”œâ”€â”€ æ–‡å­—æå–èˆ‡æ¸…ç†
â”‚   â”œâ”€â”€ ç« ç¯€åˆ†æ®µ
â”‚   â”œâ”€â”€ èªéŸ³åˆæˆ
â”‚   â””â”€â”€ éŸ³é »æª”æ¡ˆç®¡ç†
â”‚
â””â”€â”€ è¼¸å‡ºç›®éŒ„
    â”œâ”€â”€ audiobooks/                  # åŸºç¤ç‰ˆæœ¬è¼¸å‡º
    â””â”€â”€ static/audiobooks/           # Qwen ç‰ˆæœ¬è¼¸å‡º
</code></pre>
<hr />
<h2 id="-4">åŠŸèƒ½ç‰¹é»</h2>
<h3 id="1epub">1. EPUB è™•ç†</h3>
<ul>
<li>âœ… è‡ªå‹•è§£æ EPUB é›»å­æ›¸</li>
<li>âœ… æå–ç« ç¯€æ¨™é¡Œå’Œå…§å®¹</li>
<li>âœ… HTML æ¨™ç±¤æ¸…ç†</li>
<li>âœ… æ–‡å­—æ­£è¦åŒ–è™•ç†</li>
<li>âœ… ç‰¹æ®Šå­—ç¬¦éæ¿¾</li>
</ul>
<h3 id="2">2. èªéŸ³åˆæˆ</h3>
<ul>
<li>âœ… å¤šèªè¨€æ”¯æ´ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ã€éŸ“æ–‡ã€ç²µèªï¼‰</li>
<li>âœ… é•·æ–‡æœ¬è‡ªå‹•åˆ†æ®µ</li>
<li>âœ… ç« ç¯€éŸ³é »ç”Ÿæˆ</li>
<li>âš ï¸ éŸ³é »åˆä½µï¼ˆéœ€è¦é¡å¤–å¯¦ç¾ï¼‰</li>
</ul>
<h3 id="3qwentts">3. Qwen TTS ç‰¹è‰²åŠŸèƒ½</h3>
<ul>
<li>âœ… æ™®é€šè©±èªéŸ³ç”Ÿæˆ</li>
<li>âœ… é–©å—èªèªéŸ³ç”Ÿæˆ</li>
<li>âœ… é›™èªç‰ˆæœ¬åŒæ™‚ç”Ÿæˆ</li>
<li>âœ… é«˜å“è³ªèªéŸ³è¼¸å‡º</li>
<li>âœ… å¤šè§’è‰²èªéŸ³æ”¯æ´</li>
</ul>
<h3 id="4">4. å…§å®¹ç®¡ç†</h3>
<ul>
<li>âœ… å»£æ’­åŠ‡åˆ—è¡¨æŸ¥è©¢</li>
<li>âœ… ç« ç¯€è³‡è¨Šç®¡ç†</li>
<li>âœ… éŸ³é »æª”æ¡ˆä¸‹è¼‰</li>
<li>âœ… å»£æ’­åŠ‡åˆªé™¤</li>
</ul>
<hr />
<h2 id="-5">ğŸ”§ æŠ€è¡“å¯¦ç¾</h2>
<h3 id="-6">ä¾è³´å¥—ä»¶</h3>
<h4 id="-7">åŸºç¤ç‰ˆæœ¬</h4>
<pre><code class="txt language-txt">Flask&gt;=3.1.0
ebooklib&gt;=0.18          # EPUB è§£æ
beautifulsoup4&gt;=4.12.2  # HTML è§£æ
</code></pre>
<h4 id="qwen">Qwen ç‰ˆæœ¬ï¼ˆé¡å¤–éœ€æ±‚ï¼‰</h4>
<pre><code class="txt language-txt">dashscope&gt;=1.24.6       # é˜¿é‡Œé›² Qwen TTS API
ebooklib&gt;=0.18
beautifulsoup4&gt;=4.12.2
</code></pre>
<h4 id="-8">éŸ³é »è™•ç†ï¼ˆå¯é¸ï¼‰</h4>
<pre><code class="txt language-txt">pydub&gt;=0.25.1           # éŸ³é »åˆä½µèˆ‡è™•ç†
ffmpeg                  # éŸ³é »æ ¼å¼è½‰æ›ï¼ˆç³»çµ±ç´šä¾è³´ï¼‰
</code></pre>
<h3 id="-9">ç•¶å‰å¥—ä»¶ç‹€æ…‹</h3>
<p><strong>âœ… å·²å®‰è£</strong></p>
<ul>
<li>Flask æ ¸å¿ƒå¥—ä»¶</li>
<li>åŸºç¤ HTTP è«‹æ±‚å¥—ä»¶</li>
</ul>
<p><strong>âŒ æœªå®‰è£ï¼ˆéœ€è¦è£œå……ï¼‰</strong></p>
<ul>
<li><code>ebooklib</code> - EPUB è§£æåº«</li>
<li><code>beautifulsoup4</code> - HTML è§£æåº«</li>
<li><code>dashscope</code> - Qwen TTS APIï¼ˆQwen ç‰ˆæœ¬éœ€è¦ï¼‰</li>
<li><code>pydub</code> - éŸ³é »è™•ç†ï¼ˆå¯é¸ï¼‰</li>
</ul>
<hr />
<h2 id="api">ğŸ“¡ API ç«¯é»</h2>
<h3 id="api-1">åŸºç¤ç‰ˆæœ¬ API</h3>
<p><strong>åŸºç¤è·¯å¾‘</strong>: <code>/api/audiobook</code></p>
<h4 id="1epub-1">1. ä¸Šå‚³ EPUB ä¸¦ç”Ÿæˆå»£æ’­åŠ‡</h4>
<pre><code class="http language-http">POST /api/audiobook/upload
Content-Type: multipart/form-data

åƒæ•¸:
  - file: EPUB æª”æ¡ˆ

å›æ‡‰:
{
  "success": true,
  "message": "EPUBæ–‡ä»¶ä¸Šå‚³ä¸¦è™•ç†æˆåŠŸ",
  "book_id": "uuid",
  "book_title": "æ›¸å",
  "chapter_count": 10
}
</code></pre>
<h4 id="2-1">2. ç²å–å»£æ’­åŠ‡åˆ—è¡¨</h4>
<pre><code class="http language-http">GET /api/audiobook/books

å›æ‡‰:
{
  "success": true,
  "books": [
    {
      "id": "book_id",
      "title": "æ›¸å",
      "created_at": 1699999999
    }
  ]
}
</code></pre>
<h4 id="3">3. ç²å–æ›¸ç±è©³æƒ…</h4>
<pre><code class="http language-http">GET /api/audiobook/book/{book_id}

å›æ‡‰:
{
  "success": true,
  "book": {
    "id": "book_id",
    "title": "æ›¸å",
    "chapters": [
      {
        "id": "chapter_001",
        "title": "ç¬¬ä¸€ç« ",
        "audio_url": "/api/audiobook/book/{book_id}/chapter/{chapter_id}/audio"
      }
    ]
  }
}
</code></pre>
<h4 id="4-1">4. ä¸‹è¼‰ç« ç¯€éŸ³é »</h4>
<pre><code class="http language-http">GET /api/audiobook/book/{book_id}/chapter/{chapter_id}/audio

å›æ‡‰: éŸ³é »æª”æ¡ˆ (MP3/WAV)
</code></pre>
<h4 id="5">5. åˆªé™¤å»£æ’­åŠ‡</h4>
<pre><code class="http language-http">DELETE /api/audiobook/book/{book_id}

å›æ‡‰:
{
  "success": true,
  "message": "å»£æ’­åŠ‡å·²æˆåŠŸåˆªé™¤"
}
</code></pre>
<hr />
<h3 id="qwenapi">Qwen ç‰ˆæœ¬ API</h3>
<p><strong>åŸºç¤è·¯å¾‘</strong>: <code>/api/qwen-audiobook</code></p>
<h4 id="1">1. ç”Ÿæˆå–®èªå»£æ’­åŠ‡</h4>
<pre><code class="http language-http">POST /api/qwen-audiobook/generate
Content-Type: application/json

Body:
{
  "epub_file": "book.epub",
  "dialect": "mandarin",  // æˆ– "minan"
  "api_key": "your_api_key"  // å¯é¸ï¼Œå¯å¾ç’°å¢ƒè®Šæ•¸è®€å–
}

å›æ‡‰:
{
  "success": true,
  "message": "AIå»£æ’­åŠ‡ç”ŸæˆæˆåŠŸ",
  "book_id": "uuid",
  "title": "æ›¸å",
  "dialect": "mandarin",
  "chapter_count": 10,
  "output_dir": "path/to/output"
}
</code></pre>
<h4 id="2-2">2. ç”Ÿæˆé›™èªå»£æ’­åŠ‡</h4>
<pre><code class="http language-http">POST /api/qwen-audiobook/generate-bilingual
Content-Type: application/json

Body:
{
  "epub_file": "book.epub",
  "api_key": "your_api_key"
}

å›æ‡‰:
{
  "success": true,
  "message": "é›™èªAIå»£æ’­åŠ‡ç”ŸæˆæˆåŠŸ",
  "book_id": "uuid",
  "title": "æ›¸å",
  "chapter_count": 10,
  "mandarin_output_dir": "path/to/mandarin",
  "minan_output_dir": "path/to/minan"
}
</code></pre>
<h4 id="3-1">3. ç²å–é›™èªç« ç¯€è³‡è¨Š</h4>
<pre><code class="http language-http">GET /api/qwen-audiobook/book/{book_id}/bilingual-chapters

å›æ‡‰:
{
  "success": true,
  "book": {
    "id": "book_id",
    "title": "æ›¸å",
    "mandarin_chapters": [...],
    "minan_chapters": [...]
  }
}
</code></pre>
<h4 id="4-2">4. ä¸‹è¼‰æŒ‡å®šèªè¨€çš„ç« ç¯€éŸ³é »</h4>
<pre><code class="http language-http">GET /api/qwen-audiobook/book/{book_id}/chapter/{chapter_id}/audio/{dialect}

åƒæ•¸:
  - dialect: "mandarin" æˆ– "minan"

å›æ‡‰: éŸ³é »æª”æ¡ˆ (WAV)
</code></pre>
<hr />
<h2 id="-10">ğŸ’» ä»£ç¢¼å¯¦ç¾</h2>
<h3 id="-11">æ ¸å¿ƒé¡åˆ¥</h3>
<h4 id="1audiobookservice">1. AudiobookService (åŸºç¤ç‰ˆæœ¬)</h4>
<pre><code class="python language-python">class AudiobookService:
    """AIå»£æ’­åŠ‡æœå‹™é¡"""

    def __init__(self, output_dir: str = "audiobooks"):
        self.output_dir = output_dir
        self.voice_service = VoiceSynthesisService()
        self.voice_config = VoiceConfig()

    def extract_text_from_epub(self, epub_path: str) -&gt; List[Dict[str, str]]:
        """å¾EPUBæ–‡ä»¶ä¸­æå–æ–‡æœ¬å…§å®¹"""
        # ä½¿ç”¨ ebooklib è§£æ EPUB
        # ä½¿ç”¨ BeautifulSoup æ¸…ç† HTML
        # è¿”å›ç« ç¯€åˆ—è¡¨

    def generate_audiobook(self, epub_path: str, book_id: Optional[str] = None) -&gt; Dict:
        """ç”ŸæˆAIå»£æ’­åŠ‡éŸ³é »"""
        # 1. æå– EPUB å…§å®¹
        # 2. å‰µå»ºè¼¸å‡ºç›®éŒ„
        # 3. é€ç« ç¯€ç”ŸæˆéŸ³é »
        # 4. è¿”å›æ›¸ç±è³‡è¨Š

    def _generate_chapter_audio(self, text: str, chapter_id: str, output_dir: str, title: str) -&gt; str:
        """ç”Ÿæˆå–®å€‹ç« ç¯€çš„éŸ³é »æ–‡ä»¶"""
        # 1. åˆ†æ®µè™•ç†é•·æ–‡æœ¬
        # 2. ç”Ÿæˆå„æ®µè½éŸ³é »
        # 3. åˆä½µéŸ³é »æ–‡ä»¶
        # 4. è¿”å›æœ€çµ‚éŸ³é »è·¯å¾‘
</code></pre>
<h4 id="2qwenaudiobookserviceqwen">2. QwenAudiobookService (Qwen ç‰ˆæœ¬)</h4>
<pre><code class="python language-python">class QwenAudiobookService:
    """Qwen AIå»£æ’­åŠ‡æœå‹™é¡"""

    def __init__(self, api_key: Optional[str] = None):
        self.api_key = api_key or os.getenv("DASHSCOPE_API_KEY")
        self.output_dir = os.path.join("static", "audiobooks")

    def is_available(self) -&gt; bool:
        """æª¢æŸ¥æœå‹™æ˜¯å¦å¯ç”¨"""
        return DASHSCOPE_AVAILABLE and EPUB_AVAILABLE and self.api_key is not None

    def generate_audiobook_mandarin(self, epub_path: str, book_id: Optional[str] = None) -&gt; Dict:
        """ç”Ÿæˆæ™®é€šè©±ç‰ˆæœ¬çš„AIå»£æ’­åŠ‡"""
        return self._generate_audiobook(epub_path, book_id, "Ethan", "Chinese", "mandarin")

    def generate_audiobook_minan(self, epub_path: str, book_id: Optional[str] = None) -&gt; Dict:
        """ç”Ÿæˆé–©å—èªç‰ˆæœ¬çš„AIå»£æ’­åŠ‡"""
        return self._generate_audiobook(epub_path, book_id, "Roy", "Chinese", "minan")

    def generate_bilingual_audiobook(self, epub_path: str, book_id: Optional[str] = None) -&gt; Dict:
        """ç”Ÿæˆé›™èªç‰ˆæœ¬çš„AIå»£æ’­åŠ‡"""
        # åŒæ™‚ç”Ÿæˆæ™®é€šè©±å’Œé–©å—èªç‰ˆæœ¬

    def _tts_synthesize(self, text: str, output_file: str, voice: str, language_type: str):
        """ä½¿ç”¨Qwen TTS APIåˆæˆèªéŸ³"""
        response = dashscope.MultiModalConversation.call(
            api_key=self.api_key,
            model="qwen3-tts-flash",
            text=text,
            voice=voice,
            language_type=language_type,
            stream=False
        )
</code></pre>
<hr />
<h2 id="-12">ğŸ”„ è™•ç†æµç¨‹</h2>
<h3 id="epub">EPUB è½‰å»£æ’­åŠ‡æµç¨‹</h3>
<pre><code>1. ä¸Šå‚³ EPUB æª”æ¡ˆ
   â†“
2. è§£æ EPUB çµæ§‹
   â”œâ”€â”€ æå–æ›¸ç±å…ƒæ•¸æ“šï¼ˆæ›¸åã€ä½œè€…ç­‰ï¼‰
   â”œâ”€â”€ æå–ç« ç¯€åˆ—è¡¨
   â””â”€â”€ æå–ç« ç¯€å…§å®¹
   â†“
3. æ–‡å­—è™•ç†
   â”œâ”€â”€ ç§»é™¤ HTML æ¨™ç±¤
   â”œâ”€â”€ æ¸…ç†ç‰¹æ®Šå­—ç¬¦
   â”œâ”€â”€ æ­£è¦åŒ–ç©ºç™½å­—ç¬¦
   â””â”€â”€ åˆ†æ®µè™•ç†ï¼ˆæ¯æ®µ â‰¤ 1000 å­—ï¼‰
   â†“
4. èªéŸ³åˆæˆ
   â”œâ”€â”€ é¸æ“‡èªéŸ³è§’è‰²
   â”œâ”€â”€ è¨­å®šèªè¨€åƒæ•¸
   â”œâ”€â”€ é€æ®µç”ŸæˆéŸ³é »
   â””â”€â”€ åˆä½µæ®µè½éŸ³é »
   â†“
5. æª”æ¡ˆç®¡ç†
   â”œâ”€â”€ ä¿å­˜ç« ç¯€éŸ³é »
   â”œâ”€â”€ ç”Ÿæˆå…ƒæ•¸æ“š
   â””â”€â”€ å»ºç«‹ç´¢å¼•
   â†“
6. è¿”å›çµæœ
   â””â”€â”€ æ›¸ç± IDã€ç« ç¯€åˆ—è¡¨ã€éŸ³é » URL
</code></pre>
<hr />
<h2 id="-13">ğŸ“ æª”æ¡ˆçµæ§‹</h2>
<h3 id="-14">è¼¸å‡ºç›®éŒ„çµæ§‹</h3>
<pre><code>audiobooks/                          # åŸºç¤ç‰ˆæœ¬è¼¸å‡º
â”œâ”€â”€ {book_id}/
â”‚   â”œâ”€â”€ chapter_001.mp3
â”‚   â”œâ”€â”€ chapter_002.mp3
â”‚   â””â”€â”€ ...

static/audiobooks/                   # Qwen ç‰ˆæœ¬è¼¸å‡º
â”œâ”€â”€ {book_id}_mandarin/              # æ™®é€šè©±ç‰ˆæœ¬
â”‚   â”œâ”€â”€ chapter_001.wav
â”‚   â”œâ”€â”€ chapter_002.wav
â”‚   â””â”€â”€ ...
â””â”€â”€ {book_id}_minan/                 # é–©å—èªç‰ˆæœ¬
    â”œâ”€â”€ chapter_001.wav
    â”œâ”€â”€ chapter_002.wav
    â””â”€â”€ ...

uploads/audiobooks/                  # ä¸Šå‚³çš„ EPUB æª”æ¡ˆ
â””â”€â”€ {uuid}_{filename}.epub
</code></pre>
<hr />
<h2 id="-15">âš™ï¸ é…ç½®èªªæ˜</h2>
<h3 id="-16">ç’°å¢ƒè®Šæ•¸</h3>
<pre><code class="bash language-bash"># Qwen TTS API å¯†é‘°ï¼ˆQwen ç‰ˆæœ¬éœ€è¦ï¼‰
DASHSCOPE_API_KEY=your_api_key_here

# GPT-SoVITS é…ç½®ï¼ˆåŸºç¤ç‰ˆæœ¬éœ€è¦ï¼‰
GPT_SOVITS_API_URL=http://localhost:9874
</code></pre>
<h3 id="-17">é…ç½®æ–‡ä»¶</h3>
<p><strong>voice_config.py</strong></p>
<pre><code class="python language-python"># GPT-SoVITS é…ç½®
GPT_SOVITS_PATH = "./GPT-SoVITS-v4-20250422fix"
GPT_SOVITS_API_URL = "http://localhost:9874"

# ç›®éŒ„é…ç½®
UPLOAD_DIR = "./assets/audio/uploads"
OUTPUT_DIR = "./assets/audio/genvoice"

# éŸ³é »é…ç½®
SUPPORTED_FORMATS = ['.wav', '.mp3', '.flac', '.m4a', '.ogg']
MAX_FILE_SIZE = 50 * 1024 * 1024  # 50MB

# èªè¨€æ”¯æŒ
SUPPORTED_LANGUAGES = {
    'zh': 'ä¸­æ–‡',
    'en': 'English',
    'ja': 'æ—¥æœ¬èª',
    'ko': 'í•œêµ­ì–´',
    'yue': 'ç²µèª'
}
</code></pre>
<hr />
<h2 id="-18">ğŸš€ éƒ¨ç½²æŒ‡å—</h2>
<h3 id="1-1">1. å®‰è£ä¾è³´å¥—ä»¶</h3>
<h4 id="-19">åŸºç¤ç‰ˆæœ¬</h4>
<pre><code class="bash language-bash">pip install ebooklib beautifulsoup4
</code></pre>
<h4 id="qwen-1">Qwen ç‰ˆæœ¬</h4>
<pre><code class="bash language-bash">pip install ebooklib beautifulsoup4 dashscope
</code></pre>
<h4 id="-20">éŸ³é »è™•ç†ï¼ˆå¯é¸ï¼‰</h4>
<pre><code class="bash language-bash">pip install pydub

# Windows
# ä¸‹è¼‰ ffmpeg ä¸¦æ·»åŠ åˆ° PATH

# Linux
sudo apt-get install ffmpeg

# macOS
brew install ffmpeg
</code></pre>
<h3 id="2apiqwen">2. é…ç½® API å¯†é‘°ï¼ˆQwen ç‰ˆæœ¬ï¼‰</h3>
<pre><code class="bash language-bash"># è¨­å®šç’°å¢ƒè®Šæ•¸
export DASHSCOPE_API_KEY="your_api_key_here"

# æˆ–åœ¨ .env æª”æ¡ˆä¸­è¨­å®š
echo "DASHSCOPE_API_KEY=your_api_key_here" &gt; .env
</code></pre>
<h3 id="3-2">3. å•Ÿå‹•æœå‹™</h3>
<pre><code class="bash language-bash"># å•Ÿå‹• Flask æ‡‰ç”¨
python app.py

# æœå‹™å°‡åœ¨ http://localhost:5000 é‹è¡Œ
</code></pre>
<h3 id="4api">4. æ¸¬è©¦ API</h3>
<pre><code class="bash language-bash"># æ¸¬è©¦åŸºç¤ç‰ˆæœ¬
curl -X POST http://localhost:5000/api/audiobook/upload \
  -F "file=@test.epub"

# æ¸¬è©¦ Qwen ç‰ˆæœ¬
curl -X POST http://localhost:5000/api/qwen-audiobook/generate \
  -H "Content-Type: application/json" \
  -d '{
    "epub_file": "test.epub",
    "dialect": "mandarin",
    "api_key": "your_api_key"
  }'
</code></pre>
<hr />
<h2 id="-21">âš ï¸ å·²çŸ¥å•é¡Œèˆ‡é™åˆ¶</h2>
<h3 id="-22">ç•¶å‰ç‹€æ…‹</h3>
<h4 id="-23">âœ… å·²å¯¦ç¾</h4>
<ul>
<li>EPUB è§£æé‚è¼¯</li>
<li>æ–‡å­—æ¸…ç†èˆ‡è™•ç†</li>
<li>API è·¯ç”±å®šç¾©</li>
<li>é›™èªæ”¯æ´æ¶æ§‹</li>
<li>æª”æ¡ˆç®¡ç†ç³»çµ±</li>
</ul>
<h4 id="-24">âš ï¸ éœ€è¦è£œå……</h4>
<ol>
<li><strong>ä¾è³´å¥—ä»¶æœªå®‰è£</strong></li>
</ol>
<ul>
<li><code>ebooklib</code> - EPUB è§£æ</li>
<li><code>beautifulsoup4</code> - HTML æ¸…ç†</li>
<li><code>dashscope</code> - Qwen TTS API</li>
</ul>
<ol>
<li><strong>éŸ³é »åˆä½µåŠŸèƒ½</strong></li>
</ol>
<ul>
<li>ç›®å‰åªä¿ç•™ç¬¬ä¸€æ®µéŸ³é »</li>
<li>éœ€è¦å¯¦ç¾å®Œæ•´çš„éŸ³é »åˆä½µé‚è¼¯</li>
<li>å»ºè­°ä½¿ç”¨ <code>pydub</code> æˆ– <code>ffmpeg</code></li>
</ul>
<ol>
<li><strong>å…ƒæ•¸æ“šç®¡ç†</strong></li>
</ol>
<ul>
<li>æ›¸ç±æ¨™é¡Œå¾æª”åè®€å–</li>
<li>ç« ç¯€æ¨™é¡Œéœ€è¦å¾ EPUB å…ƒæ•¸æ“šæå–</li>
<li>éœ€è¦å»ºç«‹å®Œæ•´çš„å…ƒæ•¸æ“šç´¢å¼•</li>
</ul>
<ol>
<li><strong>éŒ¯èª¤è™•ç†</strong></li>
</ol>
<ul>
<li>éœ€è¦æ›´å®Œå–„çš„ç•°å¸¸è™•ç†</li>
<li>éœ€è¦æ·»åŠ é‡è©¦æ©Ÿåˆ¶</li>
<li>éœ€è¦æ·»åŠ é€²åº¦è¿½è¹¤</li>
</ul>
<h4 id="-25">âŒ æœªå¯¦ç¾</h4>
<ul>
<li>éŸ³é »å“è³ªè©•ä¼°</li>
<li>å¤šè§’è‰²é…éŸ³</li>
<li>èƒŒæ™¯éŸ³æ¨‚æ•´åˆ</li>
<li>éŸ³æ•ˆæ·»åŠ </li>
<li>æ‰¹æ¬¡è™•ç†</li>
<li>é€²åº¦é€šçŸ¥</li>
</ul>
<hr />
<h2 id="-26">ğŸ”§ ä¿®å¾©å»ºè­°</h2>
<h3 id="1-2">1. å®‰è£ç¼ºå¤±çš„å¥—ä»¶</h3>
<p>å‰µå»ºå®Œæ•´çš„ <code>requirements.txt</code>:</p>
<pre><code class="txt language-txt"># AI å»£æ’­åŠ‡ç³»çµ±ä¾è³´
ebooklib&gt;=0.18
beautifulsoup4&gt;=4.12.2
dashscope&gt;=1.24.6
pydub&gt;=0.25.1
lxml&gt;=4.9.0
</code></pre>
<p>å®‰è£å‘½ä»¤:</p>
<pre><code class="bash language-bash">pip install -r requirements.txt
</code></pre>
<h3 id="2-3">2. å¯¦ç¾éŸ³é »åˆä½µåŠŸèƒ½</h3>
<pre><code class="python language-python">from pydub import AudioSegment

def _merge_audio_files(self, audio_files: List[str], output_file: str):
    """åˆä½µå¤šå€‹éŸ³é »æ–‡ä»¶"""
    try:
        # è¼‰å…¥ç¬¬ä¸€å€‹éŸ³é »
        combined = AudioSegment.from_wav(audio_files[0])

        # é€å€‹åˆä½µå…¶ä»–éŸ³é »
        for audio_file in audio_files[1:]:
            audio = AudioSegment.from_wav(audio_file)
            combined += audio

        # åŒ¯å‡ºåˆä½µå¾Œçš„éŸ³é »
        combined.export(output_file, format="mp3")

        # æ¸…ç†è‡¨æ™‚æ–‡ä»¶
        for audio_file in audio_files:
            if os.path.exists(audio_file):
                os.remove(audio_file)

    except Exception as e:
        logger.error(f"åˆä½µéŸ³é »æ–‡ä»¶æ™‚å‡ºéŒ¯: {str(e)}")
        raise
</code></pre>
<h3 id="3-3">3. æ”¹é€²å…ƒæ•¸æ“šæå–</h3>
<pre><code class="python language-python">def _extract_book_metadata(self, epub_path: str) -&gt; Dict[str, str]:
    """æå–å®Œæ•´çš„æ›¸ç±å…ƒæ•¸æ“š"""
    try:
        book = epub.read_epub(epub_path)

        metadata = {
            'title': self._get_metadata(book, 'DC', 'title'),
            'author': self._get_metadata(book, 'DC', 'creator'),
            'publisher': self._get_metadata(book, 'DC', 'publisher'),
            'language': self._get_metadata(book, 'DC', 'language'),
            'date': self._get_metadata(book, 'DC', 'date'),
            'description': self._get_metadata(book, 'DC', 'description')
        }

        return metadata
    except Exception as e:
        logger.error(f"æå–å…ƒæ•¸æ“šå¤±æ•—: {str(e)}")
        return {'title': 'æœªçŸ¥æ›¸å'}

def _get_metadata(self, book, namespace: str, name: str) -&gt; str:
    """å®‰å…¨åœ°ç²å–å…ƒæ•¸æ“š"""
    try:
        data = book.get_metadata(namespace, name)
        return data[0][0] if data else ''
    except:
        return ''
</code></pre>
<h3 id="4-3">4. æ·»åŠ é€²åº¦è¿½è¹¤</h3>
<pre><code class="python language-python">from typing import Callable

def generate_audiobook(
    self,
    epub_path: str,
    book_id: Optional[str] = None,
    progress_callback: Optional[Callable[[int, int], None]] = None
) -&gt; Dict[str, Any]:
    """
    ç”ŸæˆAIå»£æ’­åŠ‡éŸ³é »ï¼ˆå¸¶é€²åº¦å›èª¿ï¼‰

    Args:
        epub_path: EPUBæ–‡ä»¶è·¯å¾‘
        book_id: æ›¸ç±ID
        progress_callback: é€²åº¦å›èª¿å‡½æ•¸ (current, total)
    """
    chapters = self.extract_text_from_epub(epub_path)
    total_chapters = len(chapters)

    for i, chapter in enumerate(chapters):
        # ç”Ÿæˆç« ç¯€éŸ³é »
        self._generate_chapter_audio(...)

        # å›èª¿é€²åº¦
        if progress_callback:
            progress_callback(i + 1, total_chapters)
</code></pre>
<hr />
<h2 id="-27">ğŸ“Š æ•ˆèƒ½è€ƒé‡</h2>
<h3 id="-28">è™•ç†æ™‚é–“ä¼°ç®—</h3>
<table>
<thead>
<tr>
<th>æ›¸ç±å¤§å°</th>
<th>ç« ç¯€æ•¸</th>
<th>é ä¼°æ™‚é–“ï¼ˆæ™®é€šè©±ï¼‰</th>
<th>é ä¼°æ™‚é–“ï¼ˆé›™èªï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>å°å‹ (&lt; 100KB)</td>
<td>5-10</td>
<td>2-5 åˆ†é˜</td>
<td>4-10 åˆ†é˜</td>
</tr>
<tr>
<td>ä¸­å‹ (100-500KB)</td>
<td>10-30</td>
<td>5-15 åˆ†é˜</td>
<td>10-30 åˆ†é˜</td>
</tr>
<tr>
<td>å¤§å‹ (&gt; 500KB)</td>
<td>30+</td>
<td>15+ åˆ†é˜</td>
<td>30+ åˆ†é˜</td>
</tr>
</tbody>
</table>
<h3 id="-29">è³‡æºéœ€æ±‚</h3>
<ul>
<li><strong>CPU</strong>: ä¸­ç­‰è² è¼‰ï¼ˆæ–‡å­—è™•ç†ï¼‰</li>
<li><strong>è¨˜æ†¶é«”</strong>: 512MB - 2GBï¼ˆå–æ±ºæ–¼æ›¸ç±å¤§å°ï¼‰</li>
<li><strong>ç£ç¢Ÿç©ºé–“</strong>: æ¯æœ¬æ›¸ç´„ 50-200MB</li>
<li><strong>ç¶²è·¯</strong>: Qwen API éœ€è¦ç©©å®šç¶²è·¯é€£ç·š</li>
</ul>
<h3 id="-30">å„ªåŒ–å»ºè­°</h3>
<ol>
<li><strong>æ‰¹æ¬¡è™•ç†</strong>: å¯¦ç¾éåŒæ­¥æ‰¹æ¬¡è™•ç†</li>
<li><strong>å¿«å–æ©Ÿåˆ¶</strong>: å¿«å–å·²è™•ç†çš„ç« ç¯€</li>
<li><strong>åˆ†æ•£å¼è™•ç†</strong>: ä½¿ç”¨ Celery ç­‰ä»»å‹™ä½‡åˆ—</li>
<li><strong>CDN æ•´åˆ</strong>: éŸ³é »æª”æ¡ˆä½¿ç”¨ CDN åŠ é€Ÿ</li>
</ol>
<hr />
<h2 id="-31">ğŸ” å®‰å…¨è€ƒé‡</h2>
<h3 id="api-2">API å¯†é‘°ç®¡ç†</h3>
<ul>
<li>âœ… æ”¯æ´ç’°å¢ƒè®Šæ•¸</li>
<li>âœ… æ”¯æ´è«‹æ±‚åƒæ•¸å‚³é</li>
<li>âš ï¸ å»ºè­°ä½¿ç”¨å¯†é‘°ç®¡ç†æœå‹™</li>
</ul>
<h3 id="-32">æª”æ¡ˆä¸Šå‚³å®‰å…¨</h3>
<ul>
<li>âœ… æª”æ¡ˆé¡å‹é©—è­‰ï¼ˆåªå…è¨± EPUBï¼‰</li>
<li>âœ… æª”æ¡ˆåç¨±å®‰å…¨åŒ–</li>
<li>âš ï¸ éœ€è¦æ·»åŠ æª”æ¡ˆå¤§å°é™åˆ¶</li>
<li>âš ï¸ éœ€è¦æ·»åŠ ç—…æ¯’æƒæ</li>
</ul>
<h3 id="-33">å­˜å–æ§åˆ¶</h3>
<ul>
<li>âš ï¸ ç›®å‰ç„¡èªè­‰æ©Ÿåˆ¶</li>
<li>å»ºè­°æ•´åˆ JWT èªè­‰</li>
<li>å»ºè­°æ·»åŠ ä½¿ç”¨é…é¡é™åˆ¶</li>
</ul>
<hr />
<h2 id="-34">ğŸ“ˆ æœªä¾†è¦åŠƒ</h2>
<h3 id="-35">çŸ­æœŸç›®æ¨™</h3>
<ul>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> å®‰è£ä¸¦æ¸¬è©¦æ‰€æœ‰ä¾è³´å¥—ä»¶</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> å¯¦ç¾å®Œæ•´çš„éŸ³é »åˆä½µåŠŸèƒ½</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> æ”¹é€²å…ƒæ•¸æ“šæå–</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> æ·»åŠ é€²åº¦è¿½è¹¤</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> å®Œå–„éŒ¯èª¤è™•ç†</li>
</ul>
<h3 id="-36">ä¸­æœŸç›®æ¨™</h3>
<ul>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> å¤šè§’è‰²é…éŸ³æ”¯æ´</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> èƒŒæ™¯éŸ³æ¨‚æ•´åˆ</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> éŸ³æ•ˆæ·»åŠ </li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> æ‰¹æ¬¡è™•ç†åŠŸèƒ½</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> Web UI ä»‹é¢</li>
</ul>
<h3 id="-37">é•·æœŸç›®æ¨™</h3>
<ul>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> AI è‡ªå‹•é…éŸ³å„ªåŒ–</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> æƒ…ç·’èªèª¿æ§åˆ¶</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> å¤šèªè¨€è‡ªå‹•ç¿»è­¯</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> ç¤¾ç¾¤åˆ†äº«åŠŸèƒ½</li>
<li class="task-list-item" style="list-style-type: none;"><input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"> è¡Œå‹• APP é–‹ç™¼</li>
</ul>
<hr />
<h2 id="-38">ğŸ§ª æ¸¬è©¦æŒ‡å—</h2>
<h3 id="-39">å–®å…ƒæ¸¬è©¦</h3>
<pre><code class="python language-python">import unittest
from modules.voice_processing.audiobook_service import AudiobookService

class TestAudiobookService(unittest.TestCase):
    def setUp(self):
        self.service = AudiobookService()

    def test_extract_text_from_epub(self):
        """æ¸¬è©¦ EPUB æ–‡å­—æå–"""
        chapters = self.service.extract_text_from_epub('test.epub')
        self.assertIsInstance(chapters, list)
        self.assertGreater(len(chapters), 0)

    def test_clean_text(self):
        """æ¸¬è©¦æ–‡å­—æ¸…ç†"""
        text = "  é€™æ˜¯  æ¸¬è©¦   æ–‡å­—  "
        cleaned = self.service._clean_text(text)
        self.assertEqual(cleaned, "é€™æ˜¯ æ¸¬è©¦ æ–‡å­—")

    def test_split_text_into_segments(self):
        """æ¸¬è©¦æ–‡å­—åˆ†æ®µ"""
        text = "ç¬¬ä¸€å¥ã€‚" * 100
        segments = self.service._split_text_into_segments(text, max_length=100)
        self.assertGreater(len(segments), 1)
</code></pre>
<h3 id="-40">æ•´åˆæ¸¬è©¦</h3>
<pre><code class="bash language-bash"># æ¸¬è©¦ EPUB ä¸Šå‚³
curl -X POST http://localhost:5000/api/audiobook/upload \
  -F "file=@test.epub"

# æ¸¬è©¦æ›¸ç±åˆ—è¡¨
curl http://localhost:5000/api/audiobook/books

# æ¸¬è©¦ Qwen ç”Ÿæˆ
curl -X POST http://localhost:5000/api/qwen-audiobook/generate \
  -H "Content-Type: application/json" \
  -d '{"epub_file": "test.epub", "dialect": "mandarin"}'
</code></pre>
<hr />
<h2 id="-41">ğŸ“ æŠ€è¡“æ”¯æ´</h2>
<h3 id="-42">å¸¸è¦‹å•é¡Œ</h3>
<p><strong>Q: ç‚ºä»€éº¼ç„¡æ³•è§£æ EPUB æª”æ¡ˆï¼Ÿ</strong>
A: è«‹ç¢ºèªå·²å®‰è£ <code>ebooklib</code> å¥—ä»¶ï¼š<code>pip install ebooklib</code></p>
<p><strong>Q: Qwen TTS API è¿”å›éŒ¯èª¤ï¼Ÿ</strong>
A: è«‹æª¢æŸ¥ï¼š</p>
<ol>
<li>API å¯†é‘°æ˜¯å¦æ­£ç¢º</li>
<li>ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸</li>
<li>API é…é¡æ˜¯å¦å……è¶³</li>
</ol>
<p><strong>Q: éŸ³é »æª”æ¡ˆç„¡æ³•æ’­æ”¾ï¼Ÿ</strong>
A: è«‹ç¢ºèªï¼š</p>
<ol>
<li>éŸ³é »æ ¼å¼æ˜¯å¦æ”¯æ´</li>
<li>æª”æ¡ˆæ˜¯å¦å®Œæ•´ç”Ÿæˆ</li>
<li>ç€è¦½å™¨æ˜¯å¦æ”¯æ´è©²æ ¼å¼</li>
</ol>
<p><strong>Q: ç”Ÿæˆé€Ÿåº¦å¤ªæ…¢ï¼Ÿ</strong>
A: å»ºè­°ï¼š</p>
<ol>
<li>ä½¿ç”¨æ›´å¿«çš„ TTS æ¨¡å‹</li>
<li>å¯¦ç¾æ‰¹æ¬¡è™•ç†</li>
<li>ä½¿ç”¨å¿«å–æ©Ÿåˆ¶</li>
</ol>
<h3 id="-43">éŒ¯èª¤ä»£ç¢¼</h3>
<table>
<thead>
<tr>
<th>ä»£ç¢¼</th>
<th>èªªæ˜</th>
<th>è§£æ±ºæ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>è«‹æ±‚åƒæ•¸éŒ¯èª¤</td>
<td>æª¢æŸ¥è«‹æ±‚æ ¼å¼å’Œåƒæ•¸</td>
</tr>
<tr>
<td>404</td>
<td>è³‡æºä¸å­˜åœ¨</td>
<td>ç¢ºèªæ›¸ç± ID æˆ–ç« ç¯€ ID</td>
</tr>
<tr>
<td>500</td>
<td>ä¼ºæœå™¨éŒ¯èª¤</td>
<td>æŸ¥çœ‹æ—¥èªŒæª”æ¡ˆ</td>
</tr>
<tr>
<td>503</td>
<td>æœå‹™ä¸å¯ç”¨</td>
<td>æª¢æŸ¥ä¾è³´æœå‹™ç‹€æ…‹</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="-44">åƒè€ƒè³‡æº</h2>
<h3 id="-45">ç›¸é—œæ–‡ä»¶</h3>
<ul>
<li><a href="https://github.com/aerkalov/ebooklib">ebooklib æ–‡æª”</a></li>
<li><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup æ–‡æª”</a></li>
<li><a href="https://help.aliyun.com/zh/dashscope/">Qwen TTS API æ–‡æª”</a></li>
<li><a href="https://github.com/jiaaro/pydub">pydub æ–‡æª”</a></li>
</ul>
<h3 id="-46">ç›¸é—œå°ˆæ¡ˆ</h3>
<ul>
<li>GPT-SoVITS: <a href="https://github.com/RVC-Boss/GPT-SoVITS">https://github.com/RVC-Boss/GPT-SoVITS</a></li>
<li>Flask: <a href="https://flask.palletsprojects.com/">https://flask.palletsprojects.com/</a></li>
</ul>
<hr />
      </body>
      </html>
    