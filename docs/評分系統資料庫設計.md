# ğŸ—„ï¸ è©•åˆ†ç³»çµ±è³‡æ–™åº«è¨­è¨ˆ

## ğŸ“‹ æ¦‚è¿°

è©•åˆ†å›é¥‹ç³»çµ±çš„è³‡æ–™åº«è¨­è¨ˆï¼ŒåŒ…å«å°è©±è¨˜éŒ„ã€è©•åˆ†è¨˜éŒ„ã€è©³ç´°è©•åˆ†ã€æ”¹é€²å»ºè­°ç­‰è¡¨ã€‚

---

## ğŸ¯ è¨­è¨ˆåŸå‰‡

1. **æ­£è¦åŒ–**: é¿å…æ•¸æ“šå†—é¤˜
2. **å¯æ“´å±•**: æ˜“æ–¼æ·»åŠ æ–°çš„è©•åˆ†ç¶­åº¦
3. **é«˜æ•ˆæŸ¥è©¢**: å„ªåŒ–å¸¸ç”¨æŸ¥è©¢
4. **æ­·å²è¿½è¹¤**: å®Œæ•´è¨˜éŒ„æ‰€æœ‰è©•åˆ†æ­·å²

---

## ğŸ“Š ER åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users         â”‚
â”‚  (ç”¨æˆ¶è¡¨)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sessions       â”‚
â”‚  (å°è©±æœƒè©±è¡¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  conversations      â”‚      â”‚  score_records   â”‚
â”‚  (å°è©±è¨˜éŒ„è¡¨)       â”‚â—„â”€â”€â”€â”€â”€â”¤  (è©•åˆ†è¨˜éŒ„è¡¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  1:1 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ 1:N
                                      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  score_details            â”‚
                         â”‚  (è©•åˆ†è©³æƒ…è¡¨)             â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ 1:N
                                      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  suggestions              â”‚
                         â”‚  (æ”¹é€²å»ºè­°è¡¨)             â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ è³‡æ–™è¡¨è¨­è¨ˆ

### 1. users (ç”¨æˆ¶è¡¨)

**ç”¨é€”**: å­˜å„²ç”¨æˆ¶åŸºæœ¬è³‡è¨Š

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT UNIQUE NOT NULL,           -- ç”¨æˆ¶å”¯ä¸€æ¨™è­˜
    username TEXT,                          -- ç”¨æˆ¶åç¨±
    email TEXT,                             -- é›»å­éƒµä»¶
    avatar_url TEXT,                        -- é ­åƒ URL
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP,

    -- çµ±è¨ˆè³‡è¨Š
    total_sessions INTEGER DEFAULT 0,       -- ç¸½å°è©±æ¬¡æ•¸
    total_conversations INTEGER DEFAULT 0,  -- ç¸½å°è©±è¼ªæ•¸
    average_score REAL DEFAULT 0.0,         -- å¹³å‡è©•åˆ†
    best_score REAL DEFAULT 0.0,            -- æœ€ä½³è©•åˆ†

    -- ç´¢å¼•
    INDEX idx_user_id (user_id),
    INDEX idx_email (email)
);
```

**æ¬„ä½èªªæ˜**:

- `user_id`: ç”¨æˆ¶å”¯ä¸€æ¨™è­˜ï¼ˆå¯ä»¥æ˜¯ UUID æˆ–å…¶ä»–å”¯ä¸€å€¼ï¼‰
- `total_sessions`: ç”¨æ–¼å¿«é€ŸæŸ¥è©¢ç”¨æˆ¶ç¸½å°è©±æ¬¡æ•¸
- `average_score`: ç·©å­˜å¹³å‡åˆ†ï¼Œé¿å…æ¯æ¬¡è¨ˆç®—

**ç¯„ä¾‹æ•¸æ“š**:

```sql
INSERT INTO users (user_id, username, email) VALUES
('user_001', 'å¼µå°æ˜', 'ming@example.com'),
('user_002', 'æå°è¯', 'hua@example.com');
```

---

### 2. sessions (å°è©±æœƒè©±è¡¨)

**ç”¨é€”**: è¨˜éŒ„æ¯æ¬¡å°è©±æœƒè©±çš„åŸºæœ¬è³‡è¨Š

```sql
CREATE TABLE sessions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT UNIQUE NOT NULL,        -- æœƒè©±å”¯ä¸€æ¨™è­˜
    user_id TEXT NOT NULL,                  -- é—œè¯ç”¨æˆ¶

    -- æœƒè©±è³‡è¨Š
    start_time TIMESTAMP NOT NULL,          -- é–‹å§‹æ™‚é–“
    end_time TIMESTAMP,                     -- çµæŸæ™‚é–“
    duration INTEGER,                       -- æŒçºŒæ™‚é–“ï¼ˆç§’ï¼‰
    status TEXT DEFAULT 'active',           -- ç‹€æ…‹: active, ended, abandoned

    -- çµ±è¨ˆè³‡è¨Š
    conversation_count INTEGER DEFAULT 0,   -- å°è©±è¼ªæ•¸
    total_words INTEGER DEFAULT 0,          -- ç¸½å­—æ•¸

    -- å…ƒæ•¸æ“š
    device_type TEXT,                       -- è¨­å‚™é¡å‹: desktop, mobile, tablet
    browser TEXT,                           -- ç€è¦½å™¨
    ip_address TEXT,                        -- IP åœ°å€

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- å¤–éµ
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,

    -- ç´¢å¼•
    INDEX idx_session_id (session_id),
    INDEX idx_user_id (user_id),
    INDEX idx_start_time (start_time),
    INDEX idx_status (status)
);
```

**æ¬„ä½èªªæ˜**:

- `session_id`: æ¯æ¬¡å°è©±çš„å”¯ä¸€æ¨™è­˜ï¼ˆUUIDï¼‰
- `status`:
  - `active`: é€²è¡Œä¸­
  - `ended`: æ­£å¸¸çµæŸ
  - `abandoned`: ç•°å¸¸ä¸­æ–·
- `duration`: è¨ˆç®—æ–¹å¼ = end_time - start_time

**ç¯„ä¾‹æ•¸æ“š**:

```sql
INSERT INTO sessions (session_id, user_id, start_time, status) VALUES
('sess_001', 'user_001', '2025-11-21 10:00:00', 'active'),
('sess_002', 'user_001', '2025-11-21 14:30:00', 'ended');
```

---

### 3. conversations (å°è©±è¨˜éŒ„è¡¨)

**ç”¨é€”**: è¨˜éŒ„æ¯ä¸€è¼ªå°è©±çš„è©³ç´°å…§å®¹

```sql
CREATE TABLE conversations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT NOT NULL,               -- é—œè¯æœƒè©±
    sequence_number INTEGER NOT NULL,       -- å°è©±åºè™Ÿï¼ˆå¾1é–‹å§‹ï¼‰

    -- å°è©±å…§å®¹
    speaker TEXT NOT NULL,                  -- èªªè©±è€…: user, ai
    text TEXT NOT NULL,                     -- å°è©±æ–‡å­—å…§å®¹

    -- æƒ…ç·’åˆ†æ
    sentiment TEXT,                         -- æƒ…ç·’: positive, negative, neutral, etc.
    sentiment_score REAL,                   -- æƒ…ç·’åˆ†æ•¸ (0-1)
    sentiment_confidence REAL,              -- æƒ…ç·’ä¿¡å¿ƒåº¦ (0-1)

    -- èªéŸ³ç‰¹å¾µï¼ˆåƒ…ç”¨æˆ¶å°è©±ï¼‰
    audio_duration REAL,                    -- éŸ³é »æ™‚é•·ï¼ˆç§’ï¼‰
    audio_volume REAL,                      -- éŸ³é‡ (0-100)
    audio_clarity REAL,                     -- æ¸…æ™°åº¦ (0-1)
    words_per_minute INTEGER,               -- èªé€Ÿï¼ˆå­—/åˆ†é˜ï¼‰
    pause_count INTEGER,                    -- åœé “æ¬¡æ•¸

    -- æ–‡å­—ç‰¹å¾µ
    word_count INTEGER,                     -- å­—æ•¸
    unique_words INTEGER,                   -- ä¸é‡è¤‡è©æ•¸

    -- æ™‚é–“æˆ³
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- å¤–éµ
    FOREIGN KEY (session_id) REFERENCES sessions(session_id) ON DELETE CASCADE,

    -- ç´¢å¼•
    INDEX idx_session_id (session_id),
    INDEX idx_speaker (speaker),
    INDEX idx_sentiment (sentiment),
    INDEX idx_timestamp (timestamp)
);
```

**æ¬„ä½èªªæ˜**:

- `sequence_number`: å°è©±é †åºï¼Œç”¨æ–¼é‡å»ºå°è©±æµç¨‹
- `speaker`: å€åˆ†ç”¨æˆ¶å’Œ AI çš„å°è©±
- `audio_*`: èªéŸ³ç‰¹å¾µï¼Œåƒ…ç”¨æˆ¶å°è©±æœ‰å€¼
- `sentiment_confidence`: ASR æˆ–æƒ…ç·’è­˜åˆ¥çš„ä¿¡å¿ƒåº¦

**ç¯„ä¾‹æ•¸æ“š**:

```sql
INSERT INTO conversations (session_id, sequence_number, speaker, text, sentiment, word_count) VALUES
('sess_001', 1, 'user', 'ä½ å¥½ï¼Œä»Šå¤©å¤©æ°£å¾ˆå¥½', 'positive', 9),
('sess_001', 2, 'ai', 'æ‚¨å¥½ï¼ä»Šå¤©ç¢ºå¯¦æ˜¯å€‹å¥½å¤©æ°£å‘¢', 'positive', 13),
('sess_001', 3, 'user', 'æˆ‘æƒ³å•ä¸€ä¸‹é—œæ–¼æƒ…ç·’çš„å•é¡Œ', 'neutral', 12);
```

---

### 4. score_records (è©•åˆ†è¨˜éŒ„è¡¨)

**ç”¨é€”**: å­˜å„²æ¯æ¬¡å°è©±çš„ç¶œåˆè©•åˆ†

```sql
CREATE TABLE score_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT UNIQUE NOT NULL,        -- é—œè¯æœƒè©±ï¼ˆä¸€å°ä¸€ï¼‰
    user_id TEXT NOT NULL,                  -- é—œè¯ç”¨æˆ¶

    -- ä¸»è¦è©•åˆ†
    emotion_score REAL NOT NULL,            -- æƒ…ç·’è¡¨é”è©•åˆ† (0-100)
    voice_score REAL NOT NULL,              -- èªéŸ³å“è³ªè©•åˆ† (0-100)
    content_score REAL NOT NULL,            -- æ–‡å­—å…§å®¹è©•åˆ† (0-100)
    overall_score REAL NOT NULL,            -- ç¶œåˆè©•åˆ† (0-100)

    -- è©•åˆ†ç­‰ç´š
    grade TEXT NOT NULL,                    -- ç­‰ç´š: S, A, B, C, D
    stars INTEGER NOT NULL,                 -- æ˜Ÿç´š (1-5)
    title TEXT,                             -- ç¨±è™Ÿ: å¤§å¸«ç´š, å„ªç§€, è‰¯å¥½, åŠæ ¼, å¾…æ”¹é€²

    -- çµ±è¨ˆè³‡è¨Š
    conversation_count INTEGER NOT NULL,    -- å°è©±è¼ªæ•¸
    total_words INTEGER NOT NULL,           -- ç¸½å­—æ•¸
    duration INTEGER NOT NULL,              -- æŒçºŒæ™‚é–“ï¼ˆç§’ï¼‰

    -- æ™‚é–“æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- å¤–éµ
    FOREIGN KEY (session_id) REFERENCES sessions(session_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,

    -- ç´¢å¼•
    INDEX idx_session_id (session_id),
    INDEX idx_user_id (user_id),
    INDEX idx_overall_score (overall_score),
    INDEX idx_grade (grade),
    INDEX idx_created_at (created_at)
);
```

**æ¬„ä½èªªæ˜**:

- `grade`: æ ¹æ“š overall_score è¨ˆç®—
  - S: 95-100
  - A: 85-94
  - B: 75-84
  - C: 60-74
  - D: 0-59
- `stars`: å°æ‡‰æ˜Ÿç´šæ•¸é‡

**ç¯„ä¾‹æ•¸æ“š**:

```sql
INSERT INTO score_records (
    session_id, user_id,
    emotion_score, voice_score, content_score, overall_score,
    grade, stars, title,
    conversation_count, total_words, duration
) VALUES (
    'sess_002', 'user_001',
    85.5, 92.0, 78.5, 85.3,
    'A', 4, 'å„ªç§€',
    10, 450, 300
);
```

---

### 5. score_details (è©•åˆ†è©³æƒ…è¡¨)

**ç”¨é€”**: å­˜å„²å„è©•åˆ†ç¶­åº¦çš„è©³ç´°å­åˆ†æ•¸

```sql
CREATE TABLE score_details (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    record_id INTEGER NOT NULL,             -- é—œè¯è©•åˆ†è¨˜éŒ„

    -- è©•åˆ†ç¶­åº¦
    category TEXT NOT NULL,                 -- é¡åˆ¥: emotion, voice, content
    sub_category TEXT NOT NULL,             -- å­é¡åˆ¥
    score REAL NOT NULL,                    -- åˆ†æ•¸ (0-100)
    weight REAL NOT NULL,                   -- æ¬Šé‡ (0-1)

    -- è©³ç´°è³‡è¨Š
    description TEXT,                       -- æè¿°
    data JSON,                              -- é¡å¤–æ•¸æ“šï¼ˆJSON æ ¼å¼ï¼‰

    -- å¤–éµ
    FOREIGN KEY (record_id) REFERENCES score_records(id) ON DELETE CASCADE,

    -- ç´¢å¼•
    INDEX idx_record_id (record_id),
    INDEX idx_category (category),
    INDEX idx_sub_category (sub_category)
);
```

**æ¬„ä½èªªæ˜**:

- `category`: ä¸»è¦é¡åˆ¥
  - `emotion`: æƒ…ç·’è¡¨é”
  - `voice`: èªéŸ³å“è³ª
  - `content`: æ–‡å­—å…§å®¹
- `sub_category`: å­é¡åˆ¥
  - emotion: diversity, appropriateness, intensity, consistency
  - voice: clarity, volume, speed, fluency
  - content: length, richness, coherence, engagement
- `data`: å­˜å„²é¡å¤–çš„è¨ˆç®—æ•¸æ“šï¼ˆJSON æ ¼å¼ï¼‰

**ç¯„ä¾‹æ•¸æ“š**:

```sql
INSERT INTO score_details (record_id, category, sub_category, score, weight, description) VALUES
(1, 'emotion', 'diversity', 28.0, 0.30, 'æƒ…ç·’å¤šæ¨£æ€§ï¼šå‡ºç¾3ç¨®ä¸åŒæƒ…ç·’'),
(1, 'emotion', 'appropriateness', 35.0, 0.40, 'æƒ…ç·’æ°ç•¶æ€§ï¼šæƒ…ç·’èˆ‡å…§å®¹åŒ¹é…åº¦é«˜'),
(1, 'emotion', 'intensity', 17.5, 0.20, 'æƒ…ç·’å¼·åº¦ï¼šæƒ…ç·’è¡¨é”æ˜ç¢º'),
(1, 'emotion', 'consistency', 5.0, 0.10, 'æƒ…ç·’ä¸€è‡´æ€§ï¼šæƒ…ç·’è½‰æ›åˆç†'),
(1, 'voice', 'clarity', 38.0, 0.40, 'æ¸…æ™°åº¦ï¼šç™¼éŸ³æ¸…æ™°'),
(1, 'voice', 'volume', 18.0, 0.20, 'éŸ³é‡ï¼šé©ä¸­'),
(1, 'voice', 'speed', 19.0, 0.20, 'èªé€Ÿï¼šé©ç•¶'),
(1, 'voice', 'fluency', 17.0, 0.20, 'æµæš¢åº¦ï¼šæµæš¢');
```

---

### 6. suggestions (æ”¹é€²å»ºè­°è¡¨)

**ç”¨é€”**: å­˜å„²ç‚ºç”¨æˆ¶ç”Ÿæˆçš„æ”¹é€²å»ºè­°

```sql
CREATE TABLE suggestions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    record_id INTEGER NOT NULL,             -- é—œè¯è©•åˆ†è¨˜éŒ„

    -- å»ºè­°å…§å®¹
    category TEXT NOT NULL,                 -- é¡åˆ¥: æƒ…ç·’è¡¨é”, èªéŸ³å“è³ª, æ–‡å­—å…§å®¹
    icon TEXT,                              -- åœ–ç¤º emoji
    text TEXT NOT NULL,                     -- å»ºè­°æ–‡å­—
    priority TEXT NOT NULL,                 -- å„ªå…ˆç´š: high, medium, low

    -- æ’åº
    display_order INTEGER,                  -- é¡¯ç¤ºé †åº

    -- å¤–éµ
    FOREIGN KEY (record_id) REFERENCES score_records(id) ON DELETE CASCADE,

    -- ç´¢å¼•
    INDEX idx_record_id (record_id),
    INDEX idx_category (category),
    INDEX idx_priority (priority)
);
```

**æ¬„ä½èªªæ˜**:

- `priority`: å»ºè­°çš„é‡è¦ç¨‹åº¦
  - `high`: é«˜å„ªå…ˆç´šï¼ˆç´…è‰²ï¼‰
  - `medium`: ä¸­å„ªå…ˆç´šï¼ˆæ©™è‰²ï¼‰
  - `low`: ä½å„ªå…ˆç´šï¼ˆè—è‰²ï¼‰
- `display_order`: æ§åˆ¶å»ºè­°çš„é¡¯ç¤ºé †åº

**ç¯„ä¾‹æ•¸æ“š**:

```sql
INSERT INTO suggestions (record_id, category, icon, text, priority, display_order) VALUES
(1, 'æƒ…ç·’è¡¨é”', 'ğŸ˜Š', 'å˜—è©¦è¡¨é”æ›´å¤šæ¨£çš„æƒ…ç·’ï¼Œè®“å°è©±æ›´ç”Ÿå‹•', 'high', 1),
(1, 'èªéŸ³å“è³ª', 'ğŸ¤', 'èªªè©±æ™‚å¯ä»¥æ›´æ¸…æ™°ä¸€äº›ï¼Œæ³¨æ„ç™¼éŸ³', 'medium', 2),
(1, 'æ–‡å­—å…§å®¹', 'ğŸ“', 'å¯ä»¥èªªå¾—æ›´è©³ç´°ä¸€äº›ï¼Œè±å¯Œå°è©±å…§å®¹', 'medium', 3);
```

---

### 7. score_history_summary (è©•åˆ†æ­·å²æ‘˜è¦è¡¨)

**ç”¨é€”**: å¿«é€ŸæŸ¥è©¢ç”¨æˆ¶çš„è©•åˆ†è¶¨å‹¢ï¼ˆå¯é¸ï¼Œç”¨æ–¼å„ªåŒ–æŸ¥è©¢ï¼‰

```sql
CREATE TABLE score_history_summary (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,                  -- é—œè¯ç”¨æˆ¶

    -- æ™‚é–“ç¯„åœ
    period_type TEXT NOT NULL,              -- é€±æœŸé¡å‹: daily, weekly, monthly
    period_start DATE NOT NULL,             -- é€±æœŸé–‹å§‹æ—¥æœŸ
    period_end DATE NOT NULL,               -- é€±æœŸçµæŸæ—¥æœŸ

    -- çµ±è¨ˆè³‡è¨Š
    session_count INTEGER DEFAULT 0,        -- æœƒè©±æ•¸é‡
    average_score REAL DEFAULT 0.0,         -- å¹³å‡è©•åˆ†
    best_score REAL DEFAULT 0.0,            -- æœ€ä½³è©•åˆ†
    worst_score REAL DEFAULT 0.0,           -- æœ€å·®è©•åˆ†

    -- å„ç¶­åº¦å¹³å‡åˆ†
    avg_emotion_score REAL DEFAULT 0.0,
    avg_voice_score REAL DEFAULT 0.0,
    avg_content_score REAL DEFAULT 0.0,

    -- æ”¹é€²è¶¨å‹¢
    improvement REAL DEFAULT 0.0,           -- æ”¹é€²å¹…åº¦ï¼ˆèˆ‡ä¸ŠæœŸæ¯”è¼ƒï¼‰

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- å¤–éµ
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,

    -- ç´¢å¼•
    INDEX idx_user_id (user_id),
    INDEX idx_period (period_type, period_start),

    -- å”¯ä¸€ç´„æŸ
    UNIQUE (user_id, period_type, period_start)
);
```

**ç”¨é€”**:

- å¿«é€ŸæŸ¥è©¢ç”¨æˆ¶çš„è©•åˆ†è¶¨å‹¢
- é¿å…æ¯æ¬¡éƒ½è¨ˆç®—æ­·å²æ•¸æ“š
- å¯ä»¥å®šæœŸï¼ˆæ¯å¤©/æ¯é€±ï¼‰æ›´æ–°

---

## ğŸ” å¸¸ç”¨æŸ¥è©¢

### 1. ç²å–ç”¨æˆ¶æœ€è¿‘çš„è©•åˆ†è¨˜éŒ„

```sql
SELECT
    sr.*,
    s.start_time,
    s.end_time,
    s.duration
FROM score_records sr
JOIN sessions s ON sr.session_id = s.session_id
WHERE sr.user_id = 'user_001'
ORDER BY sr.created_at DESC
LIMIT 10;
```

### 2. ç²å–è©•åˆ†è©³æƒ…å’Œå»ºè­°

```sql
SELECT
    sr.overall_score,
    sr.grade,
    sd.category,
    sd.sub_category,
    sd.score,
    sg.text as suggestion
FROM score_records sr
LEFT JOIN score_details sd ON sr.id = sd.record_id
LEFT JOIN suggestions sg ON sr.id = sg.record_id
WHERE sr.session_id = 'sess_002'
ORDER BY sd.category, sd.sub_category, sg.display_order;
```

### 3. è¨ˆç®—ç”¨æˆ¶å¹³å‡è©•åˆ†

```sql
SELECT
    user_id,
    COUNT(*) as total_sessions,
    AVG(overall_score) as avg_score,
    MAX(overall_score) as best_score,
    MIN(overall_score) as worst_score
FROM score_records
WHERE user_id = 'user_001'
GROUP BY user_id;
```

### 4. ç²å–è©•åˆ†è¶¨å‹¢ï¼ˆæœ€è¿‘ 7 å¤©ï¼‰

```sql
SELECT
    DATE(created_at) as date,
    COUNT(*) as session_count,
    AVG(overall_score) as avg_score,
    AVG(emotion_score) as avg_emotion,
    AVG(voice_score) as avg_voice,
    AVG(content_score) as avg_content
FROM score_records
WHERE user_id = 'user_001'
    AND created_at >= DATE('now', '-7 days')
GROUP BY DATE(created_at)
ORDER BY date;
```

### 5. ç²å–å®Œæ•´å°è©±è¨˜éŒ„

```sql
SELECT
    c.sequence_number,
    c.speaker,
    c.text,
    c.sentiment,
    c.word_count,
    c.timestamp
FROM conversations c
WHERE c.session_id = 'sess_002'
ORDER BY c.sequence_number;
```

---

## ğŸ”§ è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬

```python
# database_init.py
import sqlite3
from datetime import datetime

def init_database(db_path='data/databases/emotion_analysis.db'):
    """åˆå§‹åŒ–è©•åˆ†ç³»çµ±è³‡æ–™åº«"""

    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()

    # å‰µå»ºæ‰€æœ‰è¡¨
    tables = [
        # users è¡¨
        """
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id TEXT UNIQUE NOT NULL,
            username TEXT,
            email TEXT,
            avatar_url TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            last_login_at TIMESTAMP,
            total_sessions INTEGER DEFAULT 0,
            total_conversations INTEGER DEFAULT 0,
            average_score REAL DEFAULT 0.0,
            best_score REAL DEFAULT 0.0
        )
        """,

        # sessions è¡¨
        """
        CREATE TABLE IF NOT EXISTS sessions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            session_id TEXT UNIQUE NOT NULL,
            user_id TEXT NOT NULL,
            start_time TIMESTAMP NOT NULL,
            end_time TIMESTAMP,
            duration INTEGER,
            status TEXT DEFAULT 'active',
            conversation_count INTEGER DEFAULT 0,
            total_words INTEGER DEFAULT 0,
            device_type TEXT,
            browser TEXT,
            ip_address TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
        )
        """,

        # conversations è¡¨
        """
        CREATE TABLE IF NOT EXISTS conversations (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            session_id TEXT NOT NULL,
            sequence_number INTEGER NOT NULL,
            speaker TEXT NOT NULL,
            text TEXT NOT NULL,
            sentiment TEXT,
            sentiment_score REAL,
            sentiment_confidence REAL,
            audio_duration REAL,
            audio_volume REAL,
            audio_clarity REAL,
            words_per_minute INTEGER,
            pause_count INTEGER,
            word_count INTEGER,
            unique_words INTEGER,
            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (session_id) REFERENCES sessions(session_id) ON DELETE CASCADE
        )
        """,

        # score_records è¡¨
        """
        CREATE TABLE IF NOT EXISTS score_records (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            session_id TEXT UNIQUE NOT NULL,
            user_id TEXT NOT NULL,
            emotion_score REAL NOT NULL,
            voice_score REAL NOT NULL,
            content_score REAL NOT NULL,
            overall_score REAL NOT NULL,
            grade TEXT NOT NULL,
            stars INTEGER NOT NULL,
            title TEXT,
            conversation_count INTEGER NOT NULL,
            total_words INTEGER NOT NULL,
            duration INTEGER NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (session_id) REFERENCES sessions(session_id) ON DELETE CASCADE,
            FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
        )
        """,

        # score_details è¡¨
        """
        CREATE TABLE IF NOT EXISTS score_details (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            record_id INTEGER NOT NULL,
            category TEXT NOT NULL,
            sub_category TEXT NOT NULL,
            score REAL NOT NULL,
            weight REAL NOT NULL,
            description TEXT,
            data TEXT,
            FOREIGN KEY (record_id) REFERENCES score_records(id) ON DELETE CASCADE
        )
        """,

        # suggestions è¡¨
        """
        CREATE TABLE IF NOT EXISTS suggestions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            record_id INTEGER NOT NULL,
            category TEXT NOT NULL,
            icon TEXT,
            text TEXT NOT NULL,
            priority TEXT NOT NULL,
            display_order INTEGER,
            FOREIGN KEY (record_id) REFERENCES score_records(id) ON DELETE CASCADE
        )
        """
    ]

    # åŸ·è¡Œå‰µå»ºè¡¨
    for table_sql in tables:
        cursor.execute(table_sql)

    # å‰µå»ºç´¢å¼•
    indexes = [
        "CREATE INDEX IF NOT EXISTS idx_users_user_id ON users(user_id)",
        "CREATE INDEX IF NOT EXISTS idx_sessions_session_id ON sessions(session_id)",
        "CREATE INDEX IF NOT EXISTS idx_sessions_user_id ON sessions(user_id)",
        "CREATE INDEX IF NOT EXISTS idx_conversations_session_id ON conversations(session_id)",
        "CREATE INDEX IF NOT EXISTS idx_score_records_session_id ON score_records(session_id)",
        "CREATE INDEX IF NOT EXISTS idx_score_records_user_id ON score_records(user_id)",
        "CREATE INDEX IF NOT EXISTS idx_score_details_record_id ON score_details(record_id)",
        "CREATE INDEX IF NOT EXISTS idx_suggestions_record_id ON suggestions(record_id)"
    ]

    for index_sql in indexes:
        cursor.execute(index_sql)

    conn.commit()
    conn.close()

    print("âœ… è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆ")

if __name__ == '__main__':
    init_database()
```

---

## ğŸ“Š è³‡æ–™è¡¨é—œä¿‚ç¸½çµ

```
users (1) â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€ (N) sessions
                â”‚
                â””â”€â”€â”€â”€â”€ (N) score_records

sessions (1) â”€â”€â”€â”¬â”€â”€â”€â”€â”€ (N) conversations
                â”‚
                â””â”€â”€â”€â”€â”€ (1) score_records

score_records (1) â”€â”€â”¬â”€â”€â”€ (N) score_details
                    â”‚
                    â””â”€â”€â”€ (N) suggestions
```

---

## ğŸ’¾ å­˜å„²ç©ºé–“ä¼°ç®—

å‡è¨­æ¯å€‹ç”¨æˆ¶å¹³å‡ï¼š

- 10 æ¬¡å°è©±æœƒè©±
- æ¯æ¬¡æœƒè©± 10 è¼ªå°è©±
- æ¯æ¬¡æœƒè©± 1 æ¢è©•åˆ†è¨˜éŒ„

**å–®ç”¨æˆ¶å­˜å„²**:

- users: ~500 bytes
- sessions: 10 Ã— 300 bytes = 3 KB
- conversations: 100 Ã— 500 bytes = 50 KB
- score_records: 10 Ã— 200 bytes = 2 KB
- score_details: 80 Ã— 100 bytes = 8 KB
- suggestions: 30 Ã— 150 bytes = 4.5 KB

**ç¸½è¨ˆ**: ~68 KB/ç”¨æˆ¶

**1000 ç”¨æˆ¶**: ~68 MB

---

**æ–‡æª”ç‰ˆæœ¬**: 1.0  
**å‰µå»ºæ—¥æœŸ**: 2025-11-21  
**è³‡æ–™åº«**: SQLite3
