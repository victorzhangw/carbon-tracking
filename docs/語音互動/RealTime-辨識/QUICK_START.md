# 即時語音互動系統 - 快速啟動指南

## ✅ 安裝完成確認

### 已安裝的套件

- ✅ Flask-SocketIO 5.5.1
- ✅ dashscope 1.25.1
- ✅ websocket-client 1.9.0
- ✅ python-socketio 5.14.3
- ✅ python-engineio 4.12.3

### 已設置的環境變數

- ✅ DASHSCOPE_API_KEY（已在 .env 文件中）

### 已創建的文件

- ✅ 後端服務（2 個文件）
- ✅ 前端頁面（2 個 HTML + 1 個 JS）
- ✅ 路由已註冊到 app.py
- ✅ requirements.txt 已更新

## 🚀 啟動系統

### 方法 1：使用 bStart.bat（推薦）

```cmd
bStart.bat
```

這會自動：

1. 啟動虛擬環境
2. 停止舊服務器
3. 啟動 Flask 服務器
4. 打開系統入口頁面

### 方法 2：手動啟動

```cmd
# 啟動虛擬環境
.\venv\Scripts\activate

# 啟動服務器
python app.py
```

## 🌐 訪問頁面

服務器啟動後，訪問以下 URL：

### 閩南語版本（Roy）

```
http://localhost:5000/voice_interaction_realtime/roy
```

**特色**：

- 🟠 橙色主題
- 🎤 Roy 語音（閩南語）
- 📱 適合閩南語使用者

### 國語版本（Nofish）

```
http://localhost:5000/voice_interaction_realtime/nofish
```

**特色**：

- 🔵 藍色主題
- 🎤 Nofish 語音（國語）
- 📱 適合國語使用者

## 📱 使用步驟

1. **打開頁面**

   - 選擇 Roy（閩南語）或 Nofish（國語）版本

2. **點擊「開始對話」**

   - 系統會請求麥克風權限
   - 允許後會建立連接

3. **開始說話**

   - 系統會即時顯示辨識結果
   - 辨識中的文字顯示為灰色
   - 確定的文字顯示為黑色

4. **等待 AI 回應**

   - AI 會分析您的話並生成回應
   - 回應文字顯示為藍色
   - 同時播放語音

5. **繼續對話**

   - 系統支援多輪對話
   - 會記住對話上下文

6. **結束對話**
   - 點擊「結束對話」按鈕
   - 系統會清理資源

## 🔧 故障排除

### 問題：麥克風無法訪問

**解決方案**：

1. 確認瀏覽器有麥克風權限
2. 使用 Chrome、Edge 或 Firefox
3. 確認麥克風硬體正常

### 問題：無法連接 WebSocket

**解決方案**：

1. 確認服務器正在運行
2. 檢查控制台錯誤訊息
3. 重新整理頁面

### 問題：語音無法播放

**解決方案**：

1. 檢查音量設置
2. 確認瀏覽器音頻權限
3. 查看控制台錯誤

### 問題：辨識不準確

**解決方案**：

1. 確保環境安靜
2. 說話清晰
3. 靠近麥克風

## 📊 系統狀態檢查

### 檢查服務器日誌

服務器啟動時應該看到：

```
✅ 即時語音互動模組已載入
✅ SocketIO 已啟用
✅ Qwen TTS 服務已啟用
```

### 檢查瀏覽器控制台

按 F12 打開開發者工具，應該看到：

```
✅ SocketIO 已連接
✅ 已加入會話
🎤 錄音已啟動
```

## 🎯 測試建議

### 測試對話範例

**閩南語版（Roy）**：

- "你好，今天天氣如何？"
- "我想了解一下服務內容"
- "謝謝你的幫助"

**國語版（Nofish）**：

- "你好，請問有什麼可以幫助我的？"
- "我想諮詢一些問題"
- "非常感謝"

## 📈 效能監控

### 正常延遲範圍

- ASR 辨識：< 500ms
- LLM 回應：< 2s
- TTS 合成：< 500ms
- 總延遲：< 3s

### 如果延遲過高

1. 檢查網路連接
2. 確認 API 配額
3. 查看服務器負載

## 🔐 安全提示

1. **API 密鑰**：已安全存儲在 .env 文件中
2. **會話隔離**：每個用戶獨立會話
3. **資源限制**：單次對話最長 5 分鐘
4. **隱私保護**：對話不會被永久存儲

## 📞 需要幫助？

### 查看日誌

- **服務器日誌**：Flask 窗口
- **瀏覽器日誌**：F12 開發者工具

### 常用命令

**重啟服務器**：

```cmd
# 停止服務器（在 Flask 窗口按 Ctrl+C）
# 然後重新運行
python app.py
```

**檢查依賴**：

```cmd
python test_realtime_interaction.py
```

**更新套件**：

```cmd
pip install -r requirements.txt --upgrade
```

## 🎉 開始使用

現在您可以開始使用即時語音互動系統了！

1. 確認服務器正在運行
2. 打開瀏覽器訪問頁面
3. 點擊「開始對話」
4. 開始說話！

---

**提示**：首次使用建議先測試國語版（Nofish），因為國語辨識通常更準確。

**享受即時語音互動體驗！** 🎤✨
