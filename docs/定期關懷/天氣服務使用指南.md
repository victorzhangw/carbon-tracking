# å¤©æ°£æœå‹™ä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-11-21  
**ç‹€æ…‹**: âœ… å·²ä¸Šç·š

---

## ğŸ“‹ æ¦‚è¿°

å¤©æ°£æœå‹™æ¨¡çµ„æ•´åˆäº†ä¸­å¤®æ°£è±¡ç½²é–‹æ”¾è³‡æ–™ APIï¼Œç‚ºç³»çµ±æä¾›å³æ™‚ã€æº–ç¢ºçš„å¤©æ°£è³‡è¨Šã€‚æ‰€æœ‰æ¨¡çµ„éƒ½å¯ä»¥ä½¿ç”¨æ­¤æœå‹™ã€‚

### ç‰¹è‰²åŠŸèƒ½

- âœ… **çœŸå¯¦è³‡æ–™** - ä¸­å¤®æ°£è±¡ç½²å®˜æ–¹è³‡æ–™
- âœ… **æ™ºèƒ½å¿«å–** - 1 å°æ™‚å¿«å–ï¼Œæ¸›å°‘ API èª¿ç”¨
- âœ… **è‡ªå‹•é™ç´š** - API å¤±æ•—æ™‚è‡ªå‹•ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
- âœ… **åœ°å€è§£æ** - è‡ªå‹•å¾åœ°å€æå–ç¸£å¸‚
- âœ… **é€šç”¨ä»‹é¢** - æ‰€æœ‰æ¨¡çµ„çµ±ä¸€èª¿ç”¨æ–¹å¼

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### åŸºæœ¬ä½¿ç”¨

```python
from services.weather_service import weather_service

# æ–¹æ³• 1: æ ¹æ“šåœ°å€æŸ¥è©¢
weather = weather_service.get_weather_by_address("å°åŒ—å¸‚å¤§å®‰å€ä¿¡ç¾©è·¯100è™Ÿ")

# æ–¹æ³• 2: æ ¹æ“šç¸£å¸‚æŸ¥è©¢
weather = weather_service.get_weather_by_city("è‡ºåŒ—å¸‚")

# æ–¹æ³• 3: ä½¿ç”¨ä¾¿æ·å‡½æ•¸
from services.weather_service import get_weather
weather = get_weather("é«˜é›„å¸‚å‰é‡‘å€")
```

### å›æ‡‰æ ¼å¼

```python
{
    'city': 'è‡ºåŒ—å¸‚',              # ç¸£å¸‚åç¨±
    'temperature': 22,             # ç•¶å‰æº«åº¦ï¼ˆå¹³å‡ï¼‰
    'min_temperature': 20,         # æœ€ä½æº«åº¦
    'max_temperature': 24,         # æœ€é«˜æº«åº¦
    'condition': 'å¤šé›²æ™‚æ™´',        # å¤©æ°£ç‹€æ³
    'rain_probability': 30,        # é™é›¨æ©Ÿç‡ (%)
    'comfort': 'èˆ’é©',             # èˆ’é©åº¦
    'forecast': 'ä»Šå¤©å¤©æ°£å¤šé›²æ™‚æ™´ï¼Œæº«åº¦ç´„ 20-24 åº¦ï¼Œé™é›¨æ©Ÿç‡ 30%ã€‚',
    'update_time': '2025-11-21T10:30:00',
    'data_source': 'ä¸­å¤®æ°£è±¡ç½²',
    'from_cache': False            # æ˜¯å¦ä¾†è‡ªå¿«å–
}
```

---

## ğŸ’¡ ä½¿ç”¨å ´æ™¯

### 1. å®šæœŸé—œæ‡·ç³»çµ±

```python
from modules.voice_processing.voice_care_service import VoiceCareService

care_service = VoiceCareService()

# å¾æ’ç¨‹ä¸­ç²å–å¤©æ°£ï¼ˆè‡ªå‹•ä½¿ç”¨åœ°å€ï¼‰
schedule = {
    'address': 'å°åŒ—å¸‚å¤§å®‰å€ä¿¡ç¾©è·¯100è™Ÿ',
    'latitude': 25.0330,
    'longitude': 121.5654
}

weather = care_service.get_weather_info(
    schedule['latitude'],
    schedule['longitude'],
    schedule['address']  # å„ªå…ˆä½¿ç”¨åœ°å€
)

# å¤©æ°£è³‡è¨Šæœƒè‡ªå‹•æ•´åˆåˆ°é—œæ‡·è¨Šæ¯ä¸­
```

### 2. èªéŸ³å°è©±ç³»çµ±

```python
from services.weather_service import get_weather, get_weather_advice

# é•·è€…è©¢å•ï¼šã€Œä»Šå¤©å¤©æ°£å¦‚ä½•ï¼Ÿã€
def handle_weather_query(user_address):
    # æŸ¥è©¢å¤©æ°£
    weather = get_weather(user_address)

    # ç”Ÿæˆå»ºè­°
    advice = get_weather_advice(weather)

    # çµ„åˆå›æ‡‰
    response = f"{weather['forecast']} {advice}"
    return response

# ç¯„ä¾‹
response = handle_weather_query("é«˜é›„å¸‚å‰é‡‘å€")
print(response)
# è¼¸å‡º: ä»Šå¤©å¤©æ°£å¤šé›²ï¼Œæº«åº¦ç´„ 24-26 åº¦ï¼Œé™é›¨æ©Ÿç‡ 20%ã€‚å¤©æ°£é‚„ä¸éŒ¯ï¼Œå¯ä»¥å‡ºé–€èµ°èµ°
```

### 3. è¨ªè¦–è¦åŠƒç³»çµ±

```python
from services.weather_service import weather_service

def plan_visit(visit_address, visit_date):
    """æ ¹æ“šå¤©æ°£è¦åŠƒè¨ªè¦–"""
    weather = weather_service.get_weather_by_address(visit_address)

    # æ ¹æ“šå¤©æ°£ç‹€æ³çµ¦å»ºè­°
    if weather['rain_probability'] > 70:
        return "å»ºè­°æ”¹æœŸ", "é™é›¨æ©Ÿç‡é«˜"
    elif weather['rain_probability'] > 30:
        return "å¯é€²è¡Œ", "è¨˜å¾—å¸¶é›¨å…·"
    else:
        return "é©åˆè¨ªè¦–", "å¤©æ°£è‰¯å¥½"

status, note = plan_visit("å°å—å¸‚ä¸­è¥¿å€", "2025-11-22")
print(f"è¨ªè¦–ç‹€æ…‹: {status}, å‚™è¨»: {note}")
```

### 4. å¥åº·æé†’ç³»çµ±

```python
from services.weather_service import weather_service

def check_weather_alerts(user_city):
    """æª¢æŸ¥å¤©æ°£è­¦ç¤º"""
    weather = weather_service.get_weather_by_city(user_city)

    alerts = []

    # æº«åº¦è­¦ç¤º
    if weather['max_temperature'] > 33:
        alerts.append("é«˜æº«è­¦ç¤ºï¼šè«‹å¤šè£œå……æ°´åˆ†ï¼Œé¿å…ä¸­æš‘")
    elif weather['min_temperature'] < 15:
        alerts.append("ä½æº«è­¦ç¤ºï¼šè«‹æ³¨æ„ä¿æš–ï¼Œå°å¿ƒæ„Ÿå†’")

    # é™é›¨è­¦ç¤º
    if weather['rain_probability'] > 70:
        alerts.append("é™é›¨è­¦ç¤ºï¼šå¤–å‡ºè«‹æ”œå¸¶é›¨å…·")

    # å¤©æ°£ç‹€æ³è­¦ç¤º
    if 'é›·' in weather['condition']:
        alerts.append("é›·é›¨è­¦ç¤ºï¼šç›¡é‡é¿å…å¤–å‡º")

    return alerts

alerts = check_weather_alerts("è‡ºåŒ—å¸‚")
for alert in alerts:
    print(f"âš ï¸ {alert}")
```

---

## âš™ï¸ é€²éšåŠŸèƒ½

### å¿«å–ç®¡ç†

```python
from services.weather_service import weather_service

# æŸ¥çœ‹å¿«å–è³‡è¨Š
cache_info = weather_service.get_cache_info()
print(f"å·²å¿«å–: {cache_info['total_cached']} å€‹ç¸£å¸‚")
print(f"ç¸£å¸‚: {cache_info['cities']}")

# æ¸…é™¤å¿«å–ï¼ˆå¼·åˆ¶é‡æ–°æŸ¥è©¢ï¼‰
weather_service.clear_cache()

# ä¸ä½¿ç”¨å¿«å–æŸ¥è©¢
weather = weather_service.get_weather_by_city("è‡ºåŒ—å¸‚", use_cache=False)
```

### åœ°å€è§£æ

```python
from services.weather_service import weather_service

# æ¸¬è©¦åœ°å€è§£æ
addresses = [
    "å°åŒ—å¸‚å¤§å®‰å€ä¿¡ç¾©è·¯100è™Ÿ",
    "æ–°åŒ—å¸‚æ¿æ©‹å€ä¸­å±±è·¯ä¸€æ®µ161è™Ÿ",
    "é«˜é›„å¸‚å‰é‡‘å€ä¸­æ­£å››è·¯211è™Ÿ"
]

for address in addresses:
    city = weather_service.extract_city_from_address(address)
    print(f"{address} â†’ {city}")
```

### å¤©æ°£å»ºè­°

```python
from services.weather_service import get_weather, get_weather_advice

# å–å¾—å¤©æ°£å’Œå»ºè­°
weather = get_weather("å°åŒ—å¸‚")
advice = get_weather_advice(weather)

print(f"å¤©æ°£: {weather['condition']}")
print(f"å»ºè­°: {advice}")
```

---

## ğŸ”§ é…ç½®èªªæ˜

### ç’°å¢ƒè®Šæ•¸

åœ¨ `.env` æª”æ¡ˆä¸­è¨­å®šï¼š

```bash
# ä¸­å¤®æ°£è±¡ç½²é–‹æ”¾è³‡æ–™ API
CWA_API_KEY=CWA-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
```

### é…ç½®åƒæ•¸

åœ¨ `config.py` ä¸­ï¼š

```python
# ä¸­å¤®æ°£è±¡ç½² API è¨­å®š
CWA_API_KEY = os.getenv('CWA_API_KEY', '')
CWA_API_ENABLED = bool(CWA_API_KEY)
```

### è‡ªè¨‚å¿«å–æ™‚é–“

```python
from services.weather_service import CWAWeatherService

# å»ºç«‹è‡ªè¨‚å¿«å–æ™‚é–“çš„æœå‹™ï¼ˆé è¨­60åˆ†é˜ï¼‰
custom_service = CWAWeatherService(cache_duration=30)  # 30åˆ†é˜
```

---

## ğŸ“Š æ”¯æ´ç¸£å¸‚

### ç›´è½„å¸‚

- è‡ºåŒ—å¸‚ã€æ–°åŒ—å¸‚ã€æ¡ƒåœ’å¸‚
- è‡ºä¸­å¸‚ã€è‡ºå—å¸‚ã€é«˜é›„å¸‚

### ç¸£å¸‚

- åŸºéš†å¸‚ã€æ–°ç«¹å¸‚ã€æ–°ç«¹ç¸£
- è‹—æ —ç¸£ã€å½°åŒ–ç¸£ã€å—æŠ•ç¸£
- é›²æ—ç¸£ã€å˜‰ç¾©å¸‚ã€å˜‰ç¾©ç¸£
- å±æ±ç¸£ã€å®œè˜­ç¸£ã€èŠ±è“®ç¸£
- è‡ºæ±ç¸£ã€æ¾æ¹–ç¸£ã€é‡‘é–€ç¸£ã€é€£æ±Ÿç¸£

**æ³¨æ„**: ç³»çµ±è‡ªå‹•è™•ç†ã€Œå°/è‡ºã€å­—è½‰æ›

---

## ğŸ›¡ï¸ éŒ¯èª¤è™•ç†

### è‡ªå‹•é™ç´šæ©Ÿåˆ¶

```
1. å˜—è©¦èª¿ç”¨ä¸­å¤®æ°£è±¡ç½² API
   â†“ å¤±æ•—
2. æª¢æŸ¥å¿«å–æ˜¯å¦æœ‰è³‡æ–™
   â†“ ç„¡å¿«å–
3. ä½¿ç”¨æ¨¡æ“¬æ•¸æ“šï¼ˆä¿è­‰æœå‹™å¯ç”¨ï¼‰
```

### éŒ¯èª¤é¡å‹è™•ç†

| éŒ¯èª¤æƒ…æ³     | è™•ç†æ–¹å¼                   |
| ------------ | -------------------------- |
| API Key ç„¡æ•ˆ | è‡ªå‹•ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š           |
| ç¶²è·¯é€£ç·šå¤±æ•— | å˜—è©¦ä½¿ç”¨å¿«å–ï¼Œå¦å‰‡æ¨¡æ“¬æ•¸æ“š |
| ç¸£å¸‚åç¨±éŒ¯èª¤ | ä½¿ç”¨é è¨­ç¸£å¸‚ï¼ˆå°åŒ—å¸‚ï¼‰     |
| API å›æ‡‰éŒ¯èª¤ | è¨˜éŒ„éŒ¯èª¤ï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š     |

### éŒ¯èª¤æ—¥èªŒ

```python
# ç³»çµ±æœƒè‡ªå‹•è¨˜éŒ„éŒ¯èª¤
âš ï¸ å¤©æ°£æœå‹™èª¿ç”¨å¤±æ•—ï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š: HTTP éŒ¯èª¤: 401
```

---

## ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–

### å¿«å–ç­–ç•¥

- **å¿«å–æ™‚é–“**: 60 åˆ†é˜ï¼ˆå¯è‡ªè¨‚ï¼‰
- **å¿«å–ç¯„åœ**: æŒ‰ç¸£å¸‚å¿«å–
- **æ›´æ–°ç­–ç•¥**: éæœŸè‡ªå‹•æ›´æ–°

### æ•ˆèƒ½æ•¸æ“š

```
ç¬¬ä¸€æ¬¡æŸ¥è©¢ï¼ˆAPIèª¿ç”¨ï¼‰: ~70ms
ç¬¬äºŒæ¬¡æŸ¥è©¢ï¼ˆå¿«å–ï¼‰:    <1ms
æ•ˆèƒ½æå‡: 70x+
```

### æœ€ä½³å¯¦è¸

1. **ä½¿ç”¨å¿«å–** - é è¨­å•Ÿç”¨ï¼Œå¤§å¹…æå‡æ•ˆèƒ½
2. **æ‰¹æ¬¡æŸ¥è©¢** - ç›¸åŒç¸£å¸‚çš„æŸ¥è©¢æœƒå…±äº«å¿«å–
3. **åœ°å€å„ªå…ˆ** - ä½¿ç”¨åœ°å€æ¯”ç¶“ç·¯åº¦æ›´æº–ç¢º

---

## ğŸ§ª æ¸¬è©¦

### åŸ·è¡Œæ¸¬è©¦

```bash
# åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
python test_weather_service.py

# æ•´åˆæ¸¬è©¦
python test_weather_integration.py

# å¤šç¸£å¸‚æ¸¬è©¦
python test_weather_multiple_cities.py
```

### æ¸¬è©¦è¦†è“‹

- âœ… ç¸£å¸‚æŸ¥è©¢
- âœ… åœ°å€è§£æ
- âœ… å¿«å–æ©Ÿåˆ¶
- âœ… é™ç´šè™•ç†
- âœ… å¤©æ°£å»ºè­°
- âœ… æ•´åˆæ¸¬è©¦

---

## ğŸ“ API é™åˆ¶

### ä¸­å¤®æ°£è±¡ç½² API

- **å…è²»é¡åº¦**: ç„¡é™åˆ¶
- **æ›´æ–°é »ç‡**: æ¯ 3 å°æ™‚
- **å›æ‡‰æ™‚é–“**: é€šå¸¸ < 100ms
- **è³‡æ–™ç¯„åœ**: æœªä¾† 36 å°æ™‚

### å»ºè­°

- ä½¿ç”¨å¿«å–æ¸›å°‘ API èª¿ç”¨
- åˆç†è¨­å®šå¿«å–æ™‚é–“ï¼ˆå»ºè­° 30-60 åˆ†é˜ï¼‰
- ç›£æ§ API èª¿ç”¨ç‹€æ³

---

## ğŸ”— ç›¸é—œè³‡æº

- [ä¸­å¤®æ°£è±¡ç½²é–‹æ”¾è³‡æ–™å¹³å°](https://opendata.cwa.gov.tw/)
- [API æ–‡æª”](https://opendata.cwa.gov.tw/dist/opendata-swagger.html)
- [æ•´åˆè¦æ ¼æ›¸](./ä¸­å¤®æ°£è±¡ç½²å¤©æ°£APIæ•´åˆè¦æ ¼.md)

---

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹åƒè€ƒï¼š

1. æª¢æŸ¥ `.env` ä¸­çš„ API Key æ˜¯å¦æ­£ç¢º
2. åŸ·è¡Œæ¸¬è©¦è…³æœ¬ç¢ºèªåŠŸèƒ½
3. æŸ¥çœ‹ç³»çµ±æ—¥èªŒä¸­çš„éŒ¯èª¤è¨Šæ¯
4. åƒè€ƒæ•´åˆè¦æ ¼æ›¸

---

**æ–‡æª”çµæŸ**
