# 智慧語音關懷功能更新說明

## 1. 功能概述

本次更新新增了智慧語音關懷功能模組，該模組能夠根據排程、用戶地址和當天氣象資訊提供語音關懷提醒服務。此功能擴展了系統的應用場景，為用戶提供更智能、更貼心的語音服務體驗。

## 2. 新增文件列表

### 2.1 後端文件
- `modules/voice_processing/voice_care_service.py` - 智慧語音關懷核心服務
- `routes/voice_care.py` - 智慧語音關懷路由處理
- `config/requirements/voice_care.txt` - 智慧語音關懷模組依賴

### 2.2 前端文件
- `templates/voice_care_dashboard.html` - 智慧語音關懷儀表板界面

### 2.3 資料庫更新
- 在 `database.py` 中新增了智慧語音關懷相關的資料表：
  - `voice_care_schedules` - 關懷排程表
  - `voice_care_records` - 關懷記錄表

## 3. 功能特性

### 3.1 核心功能
- 基於排程的語音關懷提醒
- 結合用戶地址的地理位置資訊
- 整合當天氣象資訊的智能提醒
- 語音訊息自動生成與播放

### 3.2 技術特點
- 支持多用戶排程管理
- 自動天氣資訊獲取（模擬實現）
- 智能語音訊息生成
- 完整的排程狀態追蹤
- RESTful API接口設計

## 4. 安裝與配置

### 4.1 依賴安裝
```bash
pip install -r config/requirements/voice_care.txt
```

### 4.2 資料庫初始化
已在 `database.py` 中新增相關資料表，系統啟動時會自動初始化。

### 4.3 路由註冊
已在 `app.py` 中註冊新的路由模組：
```python
try:
    from routes.voice_care import voice_care_bp
    app.register_blueprint(voice_care_bp)
    optional_modules.append("智慧語音關懷")
except ImportError as e:
    print(f"⚠️ 智慧語音關懷模組未載入: {e}")
```

## 5. API接口說明

### 5.1 創建關懷排程
- **URL**: `/api/voice-care/schedules`
- **方法**: POST
- **參數**: 用戶ID、排程標題、排程時間、地址、地理坐標等
- **返回**: 排程ID和創建結果

### 5.2 獲取排程資訊
- **URL**: `/api/voice-care/schedules/<schedule_id>`
- **方法**: GET
- **參數**: 排程ID
- **返回**: 排程詳細資訊

### 5.3 獲取用戶排程列表
- **URL**: `/api/voice-care/schedules/user/<user_id>`
- **方法**: GET
- **參數**: 用戶ID、狀態過濾（可選）
- **返回**: 用戶排程列表

### 5.4 更新排程狀態
- **URL**: `/api/voice-care/schedules/<schedule_id>`
- **方法**: PUT
- **參數**: 排程ID、新狀態
- **返回**: 更新結果

### 5.5 發送語音關懷
- **URL**: `/api/voice-care/schedules/<schedule_id>/send`
- **方法**: POST
- **參數**: 排程ID
- **返回**: 發送結果和音頻文件路徑

### 5.6 獲取關懷記錄
- **URL**: `/api/voice-care/records`
- **方法**: GET
- **參數**: 排程ID過濾（可選）
- **返回**: 關懷記錄列表

### 5.7 處理待處理排程
- **URL**: `/api/voice-care/process-pending`
- **方法**: POST
- **返回**: 處理結果統計

## 6. 前端功能

### 6.1 儀表板界面
- 排程創建表單
- 排程列表展示
- 關懷記錄查看
- 狀態管理功能

### 6.2 用戶體驗
- 響應式設計，適配移動端和桌面端
- 即時狀態更新
- 操作反饋提示
- 直觀的狀態標示

## 7. 技術實現細節

### 7.1 資料庫設計
- 排程表：存儲用戶設定的關懷排程
- 記錄表：存儲已發送的關懷記錄
- 外鍵關聯：確保數據一致性和完整性

### 7.2 業務邏輯
- 排程狀態管理（待處理、已完成、失敗、已取消）
- 天氣資訊整合（模擬實現）
- 語音訊息生成
- 音頻文件管理

### 7.3 數據處理
- ISO時間格式處理
- 地理坐標精度控制
- 天氣資訊序列化
- 音頻文件路徑管理

## 8. 安全考慮

### 8.1 數據安全
- 用戶數據隔離
- 敏感信息保護
- 訪問權限控制

### 8.2 系統安全
- API接口驗證
- 請求參數校驗
- 錯誤信息過濾

## 9. 性能優化

### 9.1 數據查詢
- 索引優化
- 查詢條件優化
- 分頁處理

### 9.2 音頻處理
- 音頻文件壓縮
- 臨時文件及時清理
- 存儲空間監控

## 10. 未來擴展建議

### 10.1 功能擴展
- 整合真實天氣API
- 支持多語言語音關懷
- 添加個性化訊息模板
- 實現智能排程推薦

### 10.2 技術升級
- 集成更先進的語音合成技術
- 實現智能語音互動
- 添加語音識別回饋功能
- 支持多種音頻格式

---

*本更新說明基於Flask-AICares項目現有架構設計，為智慧語音關懷功能的開發和使用提供指導。*