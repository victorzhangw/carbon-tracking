# 📦 部署模式說明

## 🎯 當前部署策略

系統已優化為**模組化架構**，支援不同的部署模式。

## 📋 Requirements 檔案說明

### 1. `requirements.txt` - 最小化部署（當前使用）

**用途：** Render 雲端部署
**包含：**

- Flask 核心
- 碳排放追蹤系統
- Excel 匯出功能

**大小：** ~20MB
**記憶體：** ~100MB
**適用：** Render Free 方案 ✅

### 2. `requirements_full.txt` - 完整功能

**用途：** 本地開發
**包含：**

- 所有功能
- 語音識別（ASR）
- 情緒識別
- AI 模型

**大小：** ~2GB
**記憶體：** ~4GB+
**適用：** 本地開發、專用伺服器

### 3. `requirements_backup.txt` - 原始備份

**用途：** 備份參考
**內容：** 原始的完整 requirements.txt

## 🚀 部署模式

### 模式 A：最小化部署（當前）

```bash
# 使用 requirements.txt
pip install -r requirements.txt
python app.py
```

**功能：**

- ✅ 碳排放追蹤系統
- ✅ Excel 匯出
- ✅ PWA 支援
- ❌ 語音識別
- ❌ 情緒識別

**適用場景：**

- Render 免費部署
- Android App 後端
- 輕量級應用

### 模式 B：完整功能（本地）

```bash
# 使用 requirements_full.txt
pip install -r requirements_full.txt
python app.py
```

**功能：**

- ✅ 所有功能
- ✅ 語音識別
- ✅ 情緒識別
- ✅ AI 模型

**適用場景：**

- 本地開發
- 專用伺服器
- GPU 加速環境

## 🔄 切換部署模式

### 切換到最小化模式

```bash
copy requirements_minimal.txt requirements.txt
git add requirements.txt
git commit -m "切換到最小化部署模式"
git push
```

### 切換到完整模式

```bash
copy requirements_full.txt requirements.txt
git add requirements.txt
git commit -m "切換到完整功能模式"
git push
```

## 📊 app.py 智能載入

app.py 已更新為**條件式導入**：

```python
# 核心功能（必須）
from routes.carbon_tracking import carbon_bp
app.register_blueprint(carbon_bp)

# 可選功能（如果套件存在才載入）
try:
    from routes.asr import asr_bp
    app.register_blueprint(asr_bp)
except ImportError:
    print("⚠️ ASR模組未載入")
```

**優點：**

- 自動適應不同環境
- 不會因為缺少套件而啟動失敗
- 靈活擴展

## 🎯 當前部署狀態

### Render 部署

- **模式：** 最小化
- **檔案：** requirements.txt
- **功能：** 碳排放追蹤
- **狀態：** 準備部署 🚀

### 本地開發

- **模式：** 完整功能
- **檔案：** requirements_full.txt
- **功能：** 所有功能
- **狀態：** 可用 ✅

## 🔮 未來擴展

### 當語音服務需要上線時

#### 選項 1：分離部署

```
主系統 (Render Free)：碳排放
語音服務 (HF Spaces)：ASR + 情緒識別
```

#### 選項 2：升級方案

```
Render Pro ($25/月)：所有功能
使用 requirements_full.txt
```

#### 選項 3：混合部署

```
前端 (Vercel)：靜態檔案
API (Render)：碳排放
AI (HF Spaces)：語音服務
```

## 📝 部署檢查清單

### Render 部署前

- [x] 使用 requirements.txt（最小化）
- [x] app.py 支援條件式導入
- [x] 測試本地運行
- [ ] 推送到 GitHub
- [ ] Render 自動部署
- [ ] 測試線上功能

### 本地開發

- [x] 使用 requirements_full.txt
- [x] 安裝所有套件
- [x] 測試所有功能
- [x] 開發新功能

## 🆘 常見問題

### Q: 為什麼要分離部署？

A: 語音識別需要大量記憶體和 GPU，免費方案無法支援。分離部署可以：

- 碳排放系統立即上線
- 節省成本
- 靈活擴展

### Q: 語音功能什麼時候上線？

A: 可以選擇：

1. 升級到付費方案
2. 使用專門的 AI 平台（Hugging Face Spaces）
3. 本地運行語音服務

### Q: 如何測試完整功能？

A: 在本地使用 requirements_full.txt：

```bash
pip install -r requirements_full.txt
python app.py
```

### Q: 會影響 Android App 嗎？

A: 不會！Android App 只使用碳排放功能，完全不受影響。

## 🎉 總結

- ✅ 系統已優化為模組化架構
- ✅ 支援輕量級部署（Render Free）
- ✅ 保留完整功能（本地開發）
- ✅ 未來可靈活擴展

**現在可以立即部署碳排放系統了！** 🚀
