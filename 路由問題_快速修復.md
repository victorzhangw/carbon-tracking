# 路由問題快速修復指南

## 🔍 問題診斷

測試結果顯示所有路由都正確配置：

- ✅ `/` → 重定向到 `/login` (302)
- ✅ `/login` → 可訪問 (200)
- ✅ `/portal` → 可訪問 (200)

## 🎯 問題原因

最可能的原因是**瀏覽器緩存**導致的重定向問題。

## ✅ 解決方案

### 方案 1: 清除瀏覽器緩存（推薦）

#### Chrome / Edge

1. 按 `Ctrl + Shift + Delete` (Windows) 或 `Cmd + Shift + Delete` (Mac)
2. 選擇「時間範圍」為「不限時間」
3. 勾選「快取圖片和檔案」
4. 點擊「清除資料」
5. 重新訪問 `http://localhost:5000/`

#### 或使用無痕模式

1. 按 `Ctrl + Shift + N` (Chrome/Edge) 或 `Ctrl + Shift + P` (Firefox)
2. 訪問 `http://localhost:5000/`

### 方案 2: 強制重新載入

1. 訪問 `http://localhost:5000/`
2. 按 `Ctrl + F5` (Windows) 或 `Cmd + Shift + R` (Mac)
3. 這會強制瀏覽器重新載入頁面，忽略緩存

### 方案 3: 直接訪問登入頁面

如果上述方法都不行，直接訪問：

```
http://localhost:5000/login
```

### 方案 4: 重啟 Flask 應用

1. 停止當前的 Flask 應用 (Ctrl + C)
2. 重新啟動：

```bash
python app.py
```

3. 訪問 `http://localhost:5000/`

### 方案 5: 檢查 Flask 控制台

查看 Flask 控制台的輸出，確認：

```
✅ 已載入可選模組: 主頁面, ...
```

如果看到「主頁面」已載入，表示路由正確註冊。

## 🧪 驗證步驟

### 1. 測試路由配置

```bash
python test_routes.py
```

應該看到：

```
✅ /                              → main.index
✅ /login                         → main.login_page
✅ /portal                        → portal
✅ /emotion-analysis              → main.emotion_analysis

訪問 /
  狀態碼: 302
  重定向到: /login
  ✅ 正確重定向到登入頁面
```

### 2. 測試瀏覽器訪問

#### 步驟 1: 訪問首頁

```
http://localhost:5000/
```

**預期結果**: 自動跳轉到 `/login`

#### 步驟 2: 登入

- 使用快速登入（例如：管理員）
- 或輸入用戶名稱和密碼

**預期結果**: 跳轉到 `/portal`

#### 步驟 3: 驗證 Portal

- 應該看到系統入口頁面
- 右上角顯示用戶名稱和登出按鈕

## 🐛 如果還是 404

### 檢查 1: Flask 應用是否正常啟動

查看控制台輸出，應該看到：

```
✅ 碳排放追蹤系統已載入
✅ 已載入可選模組: 主頁面, ...
 * Running on http://127.0.0.1:5000
```

### 檢查 2: 訪問的 URL 是否正確

確認訪問的是：

```
http://localhost:5000/
```

而不是：

```
http://localhost:5000/portal  ← 這個會直接訪問 portal
```

### 檢查 3: 端口是否正確

確認 Flask 運行在 5000 端口：

```bash
# 查看 Flask 控制台輸出
* Running on http://127.0.0.1:5000
```

如果是其他端口（例如 5001），訪問對應的端口。

### 檢查 4: 防火牆或代理

確認沒有防火牆或代理阻擋 localhost 訪問。

## 📊 完整測試流程

```
1. 停止 Flask 應用
   ↓
2. 清除瀏覽器緩存
   ↓
3. 重新啟動 Flask 應用
   python app.py
   ↓
4. 等待應用完全啟動
   看到 "Running on http://127.0.0.1:5000"
   ↓
5. 使用無痕模式訪問
   http://localhost:5000/
   ↓
6. 驗證重定向
   應該自動跳轉到 /login
   ↓
7. 快速登入
   點擊「管理員」
   ↓
8. 驗證跳轉
   應該跳轉到 /portal
   ↓
9. 驗證用戶資訊
   右上角顯示「👤 管理員」
```

## 🔧 開發者工具檢查

### Chrome DevTools

1. 按 `F12` 打開開發者工具
2. 切換到「Network」標籤
3. 勾選「Disable cache」
4. 訪問 `http://localhost:5000/`
5. 查看請求：

```
Request URL: http://localhost:5000/
Status Code: 302 Found
Location: /login
```

如果看到 `302` 和 `Location: /login`，表示重定向正常。

### 查看 Console

切換到「Console」標籤，查看是否有 JavaScript 錯誤。

## 💡 常見問題

### Q1: 為什麼我看到的還是 portal？

**A**: 可能是瀏覽器緩存了舊的重定向。解決方法：

1. 清除緩存
2. 使用無痕模式
3. 強制重新載入 (Ctrl + F5)

### Q2: 404 Not Found 是什麼意思？

**A**: 表示路由不存在。可能原因：

1. Flask 應用沒有正確啟動
2. Blueprint 沒有正確註冊
3. 訪問的 URL 錯誤

解決方法：

1. 運行 `python test_routes.py` 檢查路由
2. 查看 Flask 控制台輸出
3. 確認訪問的 URL 正確

### Q3: 登入後還是跳回登入頁面？

**A**: 可能是 localStorage 沒有正確保存。解決方法：

1. 打開開發者工具 (F12)
2. 切換到「Application」→「Local Storage」
3. 檢查是否有 `currentUser`
4. 如果沒有，檢查 JavaScript 控制台的錯誤

### Q4: 右上角沒有顯示用戶資訊？

**A**: JavaScript 可能沒有正確執行。解決方法：

1. 打開開發者工具 (F12)
2. 切換到「Console」標籤
3. 查看是否有錯誤訊息
4. 確認 `checkLoginStatus()` 函數有執行

## 🎉 成功標誌

當一切正常時，你應該看到：

1. **訪問首頁** (`http://localhost:5000/`)

   - 自動跳轉到 `/login`

2. **登入頁面**

   - 顯示登入表單
   - 有快速登入按鈕

3. **登入成功**

   - 跳轉到 `/portal`
   - 右上角顯示「👤 用戶名稱」和「登出」按鈕

4. **Portal 頁面**

   - 顯示所有功能模組
   - 可以點擊進入各功能

5. **功能頁面**
   - 自動檢查登入狀態
   - 顯示用戶資訊
   - 可以正常使用功能

## 📞 還是有問題？

如果以上方法都試過了還是有問題，請：

1. 運行測試腳本並截圖：

```bash
python test_routes.py
```

2. 查看 Flask 控制台的完整輸出

3. 打開瀏覽器開發者工具 (F12)，查看：

   - Network 標籤的請求
   - Console 標籤的錯誤
   - Application → Local Storage 的內容

4. 提供以上資訊以便進一步診斷

---

**記住**: 90% 的路由問題都是瀏覽器緩存造成的！先清除緩存再說 😊
