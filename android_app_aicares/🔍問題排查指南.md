# 🔍 Android APP 問題排查指南

## 常見問題與解決方案

### ❌ 問題 1：Gradle 同步失敗

**錯誤訊息：**

```
Could not resolve all dependencies
```

**解決方法：**

1. **檢查網路連線**

   ```bash
   ping google.com
   ```

2. **清除 Gradle 快取**

   ```bash
   gradlew clean
   gradlew --stop
   ```

3. **在 Android Studio 中：**

   - File → Invalidate Caches / Restart
   - 選擇 "Invalidate and Restart"

4. **手動下載 Gradle**
   - 刪除 `.gradle` 資料夾
   - 重新開啟 Android Studio

---

### ❌ 問題 2：找不到 Java

**錯誤訊息：**

```
ERROR: JAVA_HOME is not set
```

**解決方法：**

1. **檢查 Java 是否安裝**

   ```bash
   java -version
   ```

2. **設定 JAVA_HOME 環境變數**

   - 找到 JDK 安裝路徑（例如：`C:\Program Files\Java\jdk-17`）
   - 設定環境變數：
     ```
     JAVA_HOME=C:\Program Files\Java\jdk-17
     ```

3. **重新啟動命令提示字元**

---

### ❌ 問題 3：module() 方法錯誤

**錯誤訊息：**

```
Could not find method module()
```

**解決方法：**

✅ **已修復！** 我們已經更新了 Gradle 配置文件。

如果還有問題：

1. 確認使用最新的配置文件
2. 刪除 `.gradle` 資料夾
3. 重新同步

---

### ❌ 問題 4：無法連接伺服器

**APP 顯示：**

```
無法連線
```

**解決方法：**

1. **確認伺服器正在運行**

   - 在瀏覽器開啟：http://192.168.1.102:5000
   - 應該能看到網頁

2. **確認手機和電腦在同一 WiFi**

   - 手機連接的 WiFi 名稱
   - 電腦連接的 WiFi 名稱
   - 必須相同

3. **檢查防火牆**

   - Windows 防火牆可能阻擋連線
   - 暫時關閉防火牆測試

4. **修改伺服器地址**
   - 編輯 `MainActivity.kt`
   - 改用電腦的實際 IP 地址

---

### ❌ 問題 5：權限被拒絕

**APP 提示：**

```
需要麥克風權限
```

**解決方法：**

1. **手動授予權限**

   - 設定 → 應用程式 → AI 客服系統
   - 權限 → 開啟「麥克風」

2. **重新安裝 APP**
   - 解除安裝舊版本
   - 重新安裝新版本

---

### ❌ 問題 6：建置速度很慢

**現象：**

- Gradle 同步要很久
- 建置 APK 要很久

**解決方法：**

1. **啟用 Gradle Daemon**

   編輯 `gradle.properties`：

   ```properties
   org.gradle.daemon=true
   org.gradle.parallel=true
   org.gradle.caching=true
   ```

2. **增加記憶體**

   ```properties
   org.gradle.jvmargs=-Xmx4096m
   ```

3. **使用本地 Maven**
   - 減少網路下載時間

---

### ❌ 問題 7：APK 無法安裝

**錯誤訊息：**

```
應用程式未安裝
```

**解決方法：**

1. **檢查 Android 版本**

   - 需要 Android 7.0 或更高
   - 設定 → 關於手機 → Android 版本

2. **允許未知來源**

   - 設定 → 安全性
   - 開啟「未知來源」或「安裝未知應用程式」

3. **檢查儲存空間**

   - 確保有足夠空間（至少 50MB）

4. **解除安裝舊版本**
   - 如果之前安裝過，先解除安裝

---

### ❌ 問題 8：WebView 顯示空白

**現象：**

- APP 開啟後是空白畫面
- 沒有載入網頁

**解決方法：**

1. **檢查網路權限**

   - AndroidManifest.xml 中應該有：
     ```xml
     <uses-permission android:name="android.permission.INTERNET" />
     ```

2. **檢查 usesCleartextTraffic**

   - 如果使用 HTTP（非 HTTPS），需要：
     ```xml
     android:usesCleartextTraffic="true"
     ```

3. **查看 Logcat**
   - 在 Android Studio 中查看錯誤訊息

---

## 🛠️ 除錯工具

### 1. 查看 Gradle 版本

```bash
gradlew --version
```

### 2. 查看專案依賴

```bash
gradlew dependencies
```

### 3. 清理並重建

```bash
gradlew clean build
```

### 4. 查看詳細錯誤

```bash
gradlew assembleDebug --stacktrace --info
```

---

## 📱 測試清單

建置完成後，測試以下功能：

- [ ] APP 能正常啟動
- [ ] 顯示 Splash 畫面
- [ ] 能連接到伺服器
- [ ] 能看到網頁內容
- [ ] 下拉可以重新整理
- [ ] 返回鍵可以回到上一頁
- [ ] 語音權限請求正常
- [ ] 能錄音（如果有語音功能）

---

## 🆘 還是無法解決？

### 方法 1：使用已經成功的配置

參考 `android_app/` 目錄中的碳排放追蹤 APP：

- 它的配置已經驗證可用
- 可以複製相同的 Gradle 配置

### 方法 2：使用 Android Studio 創建新專案

1. File → New → New Project
2. 選擇 "Empty Activity"
3. 複製我們的 MainActivity.kt
4. 複製資源文件

### 方法 3：尋求協助

提供以下資訊：

- 完整的錯誤訊息
- Gradle 版本
- Android Studio 版本
- JDK 版本
- 作業系統版本

---

## ✅ 成功指標

當看到以下訊息時，表示成功：

```
BUILD SUCCESSFUL in 30s
```

APK 檔案會在：

```
app/build/outputs/apk/debug/app-debug.apk
```

檔案大小約 2-5 MB。

---

## 💡 小技巧

1. **首次建置會比較慢**

   - Gradle 需要下載依賴
   - 之後會快很多

2. **使用 Android Studio 比較簡單**

   - 自動處理很多問題
   - 有圖形介面

3. **保持網路暢通**

   - Gradle 需要下載很多東西
   - 建議使用穩定的網路

4. **定期更新**
   - Android Studio
   - Gradle
   - SDK Tools

祝你建置順利！🎉
